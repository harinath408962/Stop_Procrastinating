const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/firebase-DyVC30o9.js","assets/vendor-Bh7CuEbS.js"])))=>i.map(i=>d[i]);
import{r as m,j as e,u as gt,L as de,S as yt,M as Ie,a as Ae,U as Ke,b as Me,H as ht,C as Ee,c as we,e as xt,T as He,f as q,D as je,g as ft,Z as pe,h as ze,A as jt,i as Ge,R as me,P as qe,k as $e,l as ve,m as ue,B as vt,n as St,p as Y,q as Z,s as fe,t as Ye,v as ge,w as bt,x as Dt,y as Tt,z as ye,E as Ve,F as Je,G as wt,I as Ze,J as kt,X as Xe,K as Ct,N as It,O as be,Q as De,Y as Te,V as Oe,W as Be,_ as At,$ as We,a0 as Et,a1 as zt,a2 as Rt,a3 as Lt,a4 as Nt,a5 as Qe,a6 as _t,a7 as Pe,a8 as Ot,a9 as Bt,aa as H,ab as Wt}from"./vendor-Bh7CuEbS.js";import{i as Pt,g as Ut,G as Ft,a as Kt,d as he,b as et,s as Re,c as Mt,o as Ht,w as Gt,e as qt,f as $t,h as Yt}from"./firebase-DyVC30o9.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const u of a)if(u.type==="childList")for(const n of u.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function s(a){const u={};return a.integrity&&(u.integrity=a.integrity),a.referrerPolicy&&(u.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?u.credentials="include":a.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(a){if(a.ep)return;a.ep=!0;const u=s(a);fetch(a.href,u)}})();const Vt="modulepreload",Jt=function(i){return"/Stop_Procrastinating/"+i},Ue={},Zt=function(t,s,r){let a=Promise.resolve();if(s&&s.length>0){let n=function(h){return Promise.all(h.map(S=>Promise.resolve(S).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),c=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));a=n(s.map(h=>{if(h=Jt(h),h in Ue)return;Ue[h]=!0;const S=h.endsWith(".css"),f=S?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${f}`))return;const p=document.createElement("link");if(p.rel=S?"stylesheet":Vt,S||(p.as="script"),p.crossOrigin="",p.href=h,c&&p.setAttribute("nonce",c),document.head.appendChild(p),S)return new Promise((C,D)=>{p.addEventListener("load",C),p.addEventListener("error",()=>D(new Error(`Unable to preload CSS for ${h}`)))})}))}function u(n){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=n,window.dispatchEvent(l),!l.defaultPrevented)throw n}return a.then(n=>{for(const l of n||[])l.status==="rejected"&&u(l.reason);return t().catch(u)})},Xt={apiKey:"AIzaSyCO5r-8hPDpEJD2qY2llWyf_gAQXVlu4CU",authDomain:"stop-procrastinating-9ffaf.firebaseapp.com",projectId:"stop-procrastinating-9ffaf",storageBucket:"stop-procrastinating-9ffaf.firebasestorage.app",messagingSenderId:"270312713724",appId:"1:270312713724:web:98e212793206ff87511679",measurementId:"G-KYLVPZXV20"},Le=Pt(Xt),G=Ut(Le),Qt=new Ft,oe=Kt(Le);let ke=null;typeof window<"u"&&"serviceWorker"in navigator&&Zt(async()=>{const{getMessaging:i}=await import("./firebase-DyVC30o9.js").then(t=>t.j);return{getMessaging:i}},__vite__mapDeps([0,1])).then(({getMessaging:i})=>{ke=i(Le)}).catch(i=>console.log("Messaging not supported",i));const d={USER_MOOD:"sp_user_mood",TASKS:"sp_tasks",SCHEDULED_TASKS:"sp_scheduled_tasks",DISTRACTION_LOGS:"sp_distraction_logs",WORK_LOGS:"sp_work_logs",REFLECTIONS:"sp_daily_reflections",USER_STATS:"sp_user_stats",EVENT_LOG:"sp_event_log"},tt=async i=>{if(i)try{const t=he(oe,"users",i.uid),s=await et(t);if(s.exists()){const r=s.data(),a=u=>{try{return typeof u=="string"?JSON.parse(u):u}catch{return u}};r.tasks&&N(d.TASKS,a(r.tasks),!0),r.scheduled&&N(d.SCHEDULED_TASKS,a(r.scheduled),!0),r.reflections&&N(d.REFLECTIONS,a(r.reflections),!0),r.stats&&N(d.USER_STATS,a(r.stats),!0),r.mood&&N(d.USER_MOOD,r.mood,!0),r.distractions&&N(d.DISTRACTION_LOGS,a(r.distractions),!0),r.work_logs&&N(d.WORK_LOGS,a(r.work_logs),!0),console.log("Full sync from cloud completed."),window.dispatchEvent(new CustomEvent("sp-data-loaded"))}}catch(t){console.error("Error loading from cloud:",t)}},rt=async(i,t,s=!1)=>{const r=G.currentUser;if(r)try{const a=he(oe,"users",r.uid);s||window.dispatchEvent(new CustomEvent("sp-sync-start"));const n={[d.TASKS]:"tasks",[d.SCHEDULED_TASKS]:"scheduled",[d.REFLECTIONS]:"reflections",[d.USER_STATS]:"stats",[d.USER_MOOD]:"mood",[d.DISTRACTION_LOGS]:"distractions",[d.WORK_LOGS]:"work_logs"}[i];if(n){const l=typeof t=="object"?JSON.stringify(t):t;await Re(a,{[n]:l},{merge:!0}),console.log(`Synced ${i} to cloud.`),s||window.dispatchEvent(new CustomEvent("sp-sync-success"))}}catch(a){console.error("Cloud sync failed:",a),s||window.dispatchEvent(new CustomEvent("sp-sync-error",{detail:a}))}},x=(i,t=null)=>{try{const s=localStorage.getItem(i);return s?JSON.parse(s):t}catch(s){return console.error(`Error reading ${i} from storage:`,s),t}},N=(i,t,s=!1)=>{try{localStorage.setItem(i,JSON.stringify(t)),s||rt(i,t)}catch(r){console.error(`Error writing ${i} to storage:`,r)}},st=()=>{const i=new Date().toDateString();let t=x(d.USER_STATS,{totalPoints:0,currentStreak:0,longestStreak:0,lastActiveDate:null});if(t.lastActiveDate!==i){const s=new Date;s.setDate(s.getDate()-1),t.lastActiveDate===s.toDateString()?t.currentStreak+=1:t.lastActiveDate===null?t.currentStreak=1:t.currentStreak+=1,t.currentStreak>t.longestStreak&&(t.longestStreak=t.currentStreak),t.lastActiveDate=i,N(d.USER_STATS,t)}return t},Ce=i=>{let t=x(d.USER_STATS,{totalPoints:0,currentStreak:0,longestStreak:0,lastActiveDate:null});return t.totalPoints+=i,N(d.USER_STATS,t),t},nt=()=>{Object.values(d).forEach(i=>{localStorage.removeItem(i)}),localStorage.removeItem("sp_user_name")},er=async()=>{if(G.currentUser){window.dispatchEvent(new CustomEvent("sp-sync-start"));try{const t=Object.values(d).map(async s=>{const r=x(s);r!==null&&await rt(s,r,!0)});return await Promise.all(t),window.dispatchEvent(new CustomEvent("sp-sync-success")),!0}catch(t){return console.error("Force sync failed:",t),window.dispatchEvent(new CustomEvent("sp-sync-error",{detail:t})),!1}}},ot=m.createContext(),it=()=>m.useContext(ot),tr=({children:i})=>{const[t,s]=m.useState(()=>{try{return localStorage.getItem("sp_theme")||"light"}catch{return"light"}});m.useEffect(()=>{const a=document.documentElement;t==="dark"?a.setAttribute("data-theme","dark"):a.removeAttribute("data-theme"),localStorage.setItem("sp_theme",t)},[t]);const r=()=>{s(a=>a==="light"?"dark":"light")};return e.jsx(ot.Provider,{value:{theme:t,toggleTheme:r},children:i})},at=async()=>"Notification"in window?Notification.permission==="granted"?!0:Notification.permission!=="denied"?await Notification.requestPermission()==="granted":!1:(console.log("This browser does not support desktop notification"),!1),rr=async()=>{if(ke)try{const i=G.currentUser;if(!i)return;if(await at()){const s=await Mt(ke,{vapidKey:"BC3s2k0hQN9HOIxnyTzaj5SZCT8E_5WMJ_VhnQxxlz0_DVbTNXAwE4k0kmyY_yhqKCTtdZf8NeZ5S3UsF_GxL2I"}).catch(r=>(console.warn("Failed to get FCM token. VAPID key likely missing or invalid.",r),null));s&&(await Re(he(oe,"users",i.uid),{fcmToken:s},{merge:!0}),console.log("FCM Token saved to profile."))}}catch(i){console.error("Error initializing background notifications:",i)}},sr=(i,t,s)=>{if(Notification.permission==="granted")try{const r=a=>{a.onclick=u=>{u.preventDefault(),window.focus(),a.close()}};if(navigator.serviceWorker&&navigator.serviceWorker.controller)navigator.serviceWorker.ready.then(a=>{a.showNotification(i,{body:t,icon:"/vite.svg",tag:s,vibrate:[200,100,200],data:{url:window.location.href}})});else{const a=new Notification(i,{body:t,icon:"/vite.svg",tag:s,requireInteraction:!0});r(a)}}catch(r){console.error("Notification failed:",r)}},Fe=i=>{const t=new Date,s=t.toLocaleDateString("en-US",{weekday:"short"}),r=t.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit"}),a="sp_last_notification_check";if(localStorage.getItem(a)===r)return[];localStorage.setItem(a,r);const n=new Date;n.setDate(n.getDate()+1);const l=n.setHours(0,0,0,0),h=x(d.SCHEDULED_TASKS,[]).filter(p=>{if(!p.startDate||!p.dueDate)return!1;const C=new Date(p.startDate).setHours(0,0,0,0),D=new Date(p.dueDate).setHours(0,0,0,0);return l>=C&&l<=D}),S=h.length>0?`
üìÖ Tomorrow: ${h[0].name}`:"",f=[];return i.forEach(p=>{if(!p.completed&&p.reminderTime&&p.reminderTime===r){let C=!1;if(p.frequency==="daily")C=!0;else if(p.frequency==="custom"&&p.repeatDays&&Array.isArray(p.repeatDays))p.repeatDays.includes(s)&&(C=!0);else if(p.frequency==="once"){const D=new Date().setHours(0,0,0,0);if(p.startDate&&p.dueDate){const g=new Date(p.startDate).setHours(0,0,0,0),v=new Date(p.dueDate).setHours(0,0,0,0);D>=g&&D<=v&&(C=!0)}else C=!0}if(C){const D=["You got this! üí™","Success starts now. üöÄ","Do it for your future self. ‚ú®","Just 5 minutes. Go! ‚è±Ô∏è","Small steps, big results. üìà"],g=D[Math.floor(Math.random()*D.length)],v=`Target: ${p.title||p.name}`,O=`${p.smallStep?`Step: ${p.smallStep}
${g}`:`Time to make progress.
${g}`}${S}`;sr(v,O,p.id),f.push(p.id)}}}),f},P=({children:i})=>{const t=gt(),s=x(d.USER_STATS,{totalPoints:0,currentStreak:0}),[r,a]=m.useState(null),{theme:u,toggleTheme:n}=it();return m.useEffect(()=>{const l=Ht(G,c=>{a(c),c&&rr()});return()=>l()},[]),m.useEffect(()=>{at();const l=setInterval(()=>{const S=x(d.TASKS,[]),f=x(d.SCHEDULED_TASKS,[]),p=[...S,...f];Fe(p)},6e4),c=x(d.TASKS,[]),h=x(d.SCHEDULED_TASKS,[]);return Fe([...c,...h]),()=>clearInterval(l)},[]),e.jsxs("div",{className:"layout-wrapper",style:{minHeight:"100vh",display:"flex",flexDirection:"column"},children:[e.jsxs("header",{style:{padding:"1rem",borderBottom:"1px solid #e2e8f0",display:"flex",justifyContent:"space-between",alignItems:"center",background:"var(--header-bg)",color:"var(--color-text-primary)"},children:[e.jsx(de,{to:"/",style:{textDecoration:"none",color:"var(--color-primary)",fontWeight:"bold"},children:"Stop Procrastinating"}),e.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"center",fontSize:"0.875rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx("span",{role:"img","aria-label":"streak",children:"üî•"}),e.jsxs("span",{children:[s.currentStreak," Days"]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx("span",{role:"img","aria-label":"points",children:"‚ú®"}),e.jsxs("span",{children:[s.totalPoints," pts"]})]}),e.jsx(de,{to:"/settings",style:{color:"var(--color-primary)",display:"flex",alignItems:"center"},children:e.jsx(yt,{size:20})}),e.jsx("button",{onClick:n,style:{background:"none",border:"none",cursor:"pointer",color:"var(--color-primary)",display:"flex",alignItems:"center",padding:"0.25rem"},"aria-label":"Toggle Theme",children:u==="light"?e.jsx(Ie,{size:20}):e.jsx(Ae,{size:20})}),r?e.jsx(de,{to:"/settings",style:{display:"flex",alignItems:"center",gap:"0.5rem",marginLeft:"0.5rem",textDecoration:"none",color:"inherit"},children:r.photoURL?e.jsx("img",{src:r.photoURL,alt:"User",style:{width:"28px",height:"28px",borderRadius:"50%",objectFit:"cover"}}):e.jsx("div",{style:{width:"24px",height:"24px",borderRadius:"50%",background:"rgba(99, 102, 241, 0.1)",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--color-primary)"},children:e.jsx(Ke,{size:16})})}):e.jsxs(de,{to:"/signin",style:{display:"flex",alignItems:"center",gap:"0.25rem",textDecoration:"none",color:"var(--color-primary)",marginLeft:"0.5rem"},children:[e.jsx(Me,{size:18}),e.jsx("span",{children:"Sign In"})]})]})]}),e.jsx("main",{style:{flex:1,paddingBottom:"2rem"},children:i}),e.jsxs("nav",{style:{position:"fixed",bottom:0,left:0,width:"100%",background:"var(--nav-bg)",borderTop:"1px solid var(--border-color)",display:"flex",justifyContent:"space-around",padding:"0.75rem 0",zIndex:100},children:[e.jsx(ce,{to:"/",icon:e.jsx(ht,{size:20}),label:"Home",active:t.pathname==="/"||t.pathname==="/mood"}),e.jsx(ce,{to:"/schedule",icon:e.jsx(Ee,{size:20}),label:"Tasks",active:t.pathname==="/schedule"}),e.jsx(ce,{to:"/limit",icon:e.jsx(we,{size:20}),label:"Limit",active:t.pathname==="/limit"}),e.jsx(ce,{to:"/reflect",icon:e.jsx(xt,{size:20}),label:"Reflect",active:t.pathname==="/reflect"}),e.jsx(ce,{to:"/analysis",icon:e.jsx(He,{size:20}),label:"Analysis",active:t.pathname==="/analysis"})]}),e.jsx("div",{style:{height:"70px"}})]})},ce=({to:i,icon:t,label:s,active:r})=>e.jsxs(de,{to:i,style:{display:"flex",flexDirection:"column",alignItems:"center",textDecoration:"none",color:r?"var(--color-primary)":"var(--color-text-secondary)",fontSize:"0.75rem"},children:[t,e.jsx("span",{style:{marginTop:"0.25rem"},children:s})]}),nr=(i,t)=>{const s={morning:{attempts:0,completed:0,totalMinutes:0,score:0},afternoon:{attempts:0,completed:0,totalMinutes:0,score:0},evening:{attempts:0,completed:0,totalMinutes:0,score:0},night:{attempts:0,completed:0,totalMinutes:0,score:0}},r=l=>{const c=new Date(l).getHours();return c>=5&&c<12?"morning":c>=12&&c<17?"afternoon":c>=17&&c<21?"evening":"night"},a=new Date;a.setDate(a.getDate()-30);const u=a.setHours(0,0,0,0),n=l=>l?new Date(l).getTime()>=u:!1;return i.forEach(l=>{if(!l.completedAt||!n(l.completedAt))return;const c=r(l.completedAt);s[c].attempts++,s[c].completed++,s[c].totalMinutes+=parseInt(l.timeTaken)||0}),t.forEach(l=>{if(!n(l.date))return;const c=r(l.date);s[c].attempts++,s[c].completed++,s[c].totalMinutes+=parseInt(l.duration)||0}),Object.keys(s).forEach(l=>{const c=s[l];c.score=c.totalMinutes+c.completed*10}),s},or=i=>{const t={},s={morning:0,afternoon:0,evening:0,night:0},r=new Date;r.setDate(r.getDate()-30);const a=r.setHours(0,0,0,0);return i.forEach(n=>{if(!n.date||new Date(n.date).getTime()<a)return;t[n.app]=(t[n.app]||0)+1;const l=new Date(n.date).getHours();let c="night";l>=5&&l<12?c="morning":l>=12&&l<17?c="afternoon":l>=17&&l<21&&(c="evening"),s[c]++}),{sortedTriggers:Object.entries(t).sort(([,n],[,l])=>l-n).map(([n,l])=>({app:n,count:l})),timePatterns:s}},lt=()=>{const i=x(d.TASKS,[]),t=x(d.SCHEDULED_TASKS,[]),s=x(d.WORK_LOGS,[]),r=x(d.DISTRACTION_LOGS,[]),a=[...i,...t],u=nr(a,s),{sortedTriggers:n,timePatterns:l}=or(r),c=[];let h="morning",S=-1;if(Object.entries(u).forEach(([f,p])=>{p.score>S&&(S=p.score,h=f)}),S>50&&c.push({type:"success",title:"‚ú® Peak Performance",text:`You are naturally most productive in the **${h}**. Schedule your hardest tasks then!`}),n.length>0){const f=n[0];let p="night",C=-1;Object.entries(l).forEach(([D,g])=>{g>C&&(C=g,p=D)}),C>2&&c.push({type:"warning",title:"‚ö†Ô∏è Distraction Alert",text:`Watch out for **${f.app}** in the ${p}. It's your top distraction.`})}return c.length<2&&c.push({type:"info",title:"üí° Tip",text:"Log more work and distractions to unlock deeper insights into your habits."}),c},ir=()=>{const i=q(),[t,s]=m.useState("Friend"),[r,a]=m.useState(0),[u,n]=m.useState(0),[l,c]=m.useState("Start your day!"),[h,S]=m.useState(null),[f,p]=m.useState([]),[C,D]=m.useState([]),[g,v]=m.useState(null),[T,O]=m.useState(null);m.useEffect(()=>{const b=R=>{R.preventDefault(),O(R)};return window.addEventListener("beforeinstallprompt",b),()=>window.removeEventListener("beforeinstallprompt",b)},[]);const B=async()=>{if(!T)return;T.prompt();const{outcome:b}=await T.userChoice;b==="accepted"&&O(null)};return m.useEffect(()=>{s(x(d.USER_NAME,"Friend"));const b=x(d.USER_STATS,{currentStreak:0,totalPoints:0});a(b.currentStreak),n(b.totalPoints);const R=()=>{new Date().setHours(0,0,0,0);const I=x(d.DISTRACTION_LOGS,[]).filter(k=>new Date(k.date).toDateString()===new Date().toDateString()),_=I.reduce((k,U)=>k+parseInt(U.duration||0),0),W=I.length,A={};I.forEach(k=>{A[k.app]=(A[k.app]||0)+parseInt(k.duration||0)});const y=Object.entries(A).sort(([,k],[,U])=>U-k).slice(0,3).map(([k,U])=>({name:k,duration:U}));D(y);const j=x(d.TASKS,[]),F=x(d.SCHEDULED_TASKS,[]),X=j.filter(k=>k.completed&&k.completedAt&&new Date(k.completedAt).toDateString()===new Date().toDateString()),$=F.filter(k=>k.completed&&k.completedAt&&new Date(k.completedAt).toDateString()===new Date().toDateString()),te=[...X,...$],V=te.reduce((k,U)=>k+(parseInt(U.timeTaken)||0),0),re=x(d.WORK_LOGS,[]).filter(k=>new Date(k.date).toDateString()===new Date().toDateString()),se=re.reduce((k,U)=>k+parseInt(U.duration||0),0),ne=V+se,ae=te.length,le=te.reduce((k,U)=>{if(U.pointsEarned!==void 0)return k+U.pointsEarned;const pt=parseInt(U.timeTaken)||0;return k+10+pt},0),Q=re.reduce((k,U)=>k+parseInt(U.duration||0),0),z=le+Q;let o=0,w=0;const E=ne+_;let K="Ready to start?";if(E>0){const k=Math.round(_/E*100);w=k,o=100-k,o>=80?K="You are on fire! üî• Highly Focused.":o>=50?K="Good flow. Keep working! üí™":o>=30?K="Distractions are creeping in. ‚ö†Ô∏è":K="Procrastination is winning. Fight back! üõ°Ô∏è"}c(K);const J=x(d.REFLECTIONS,[]).sort((k,U)=>new Date(U.date)-new Date(k.date))[0],ut=J?J.tomorrowGoal:null;v({date:new Date().toISOString(),workScore:o,procrastinationScore:w,tasksDoneCount:ae,pointsScored:z,distractionTime:_,distractionCount:W,tomorrowGoal:ut,workTime:ne,isLive:!0})},L=lt();p(L),L&&L.length>0&&S(L[0]),R()},[]),e.jsx(P,{children:e.jsxs("div",{className:"container",style:{textAlign:"center",paddingTop:"2rem"},children:[T&&e.jsx("div",{style:{marginBottom:"1.5rem"},children:e.jsxs("button",{onClick:B,style:{background:"var(--color-primary)",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"2rem",display:"inline-flex",alignItems:"center",gap:"0.5rem",margin:"0 auto",cursor:"pointer",fontSize:"0.9rem",boxShadow:"0 4px 6px -1px rgba(99, 102, 241, 0.3)"},children:[e.jsx(je,{size:16})," Install App"]})}),e.jsx("h1",{style:{fontSize:"2.5rem",marginBottom:"0.5rem",background:"linear-gradient(135deg, #6366f1 0%, #a855f7 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Productivity"}),e.jsx("p",{style:{fontSize:"1.2rem",color:"var(--color-text-secondary)",marginBottom:"2rem"},children:"Start small. Be kind to yourself."}),e.jsxs("div",{className:"card",style:{textAlign:"left",marginBottom:"2rem"},children:[e.jsxs("h3",{style:{margin:"0 0 1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(ft,{className:"text-secondary",size:20}),"Your Progress"]}),e.jsx("div",{style:{marginBottom:"1rem",padding:"0.75rem",background:"var(--color-bg-accent)",borderRadius:"var(--radius-md)",fontWeight:"500",color:"var(--color-primary)"},children:l}),h&&h.type!=="neutral"&&e.jsxs("div",{style:{marginBottom:"1rem",padding:"0.75rem",background:h.type==="warning"?"#fef2f2":h.type==="success"?"#f0fdf4":"#f0f9ff",borderRadius:"var(--radius-md)",border:h.type==="warning"?"1px solid #fecaca":h.type==="success"?"1px solid #bbf7d0":"1px solid #bae6fd",fontSize:"0.9rem",display:"flex",gap:"0.5rem",alignItems:"start"},children:[e.jsx(pe,{size:16,style:{marginTop:"2px",color:h.type==="warning"?"#ef4444":h.type==="success"?"#15803d":"#0284c7"}}),e.jsxs("span",{style:{color:h.type==="warning"?"#b91c1c":h.type==="success"?"#166534":"#0369a1"},children:[e.jsxs("strong",{children:[h.title,":"]})," ",h.text.replace(/\*\*/g,"")]})]}),e.jsxs("ul",{style:{paddingLeft:"1.5rem",color:"var(--color-text-secondary)",lineHeight:"1.6",marginBottom:"1rem"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:r})," Total Days Active"]}),e.jsxs("li",{children:[e.jsx("strong",{children:u})," Focus Points"]})]}),C.length>0&&e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.9rem",fontWeight:"bold",color:"var(--color-text-primary)",marginBottom:"0.75rem"},children:"Top Distractions Today:"}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:C.map((b,R)=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",background:"#fff1f2",padding:"0.75rem 1rem",borderRadius:"var(--radius-md)",borderLeft:"4px solid #f43f5e"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx(ze,{size:16,color:"#f43f5e"}),e.jsx("span",{style:{color:"#be123c",fontWeight:"500"},children:b.name})]}),e.jsxs("span",{style:{fontWeight:"bold",color:"#be123c"},children:[b.duration,"m"]})]},R))})]})]}),e.jsx("div",{style:{marginTop:"2rem"},children:e.jsxs("button",{className:"btn-primary",onClick:()=>i("/mood"),children:["Get Started ",e.jsx(jt,{size:18,style:{marginLeft:"0.5rem"}})]})}),g&&e.jsxs("div",{style:{marginTop:"3rem",textAlign:"left"},children:[e.jsxs("h3",{style:{display:"flex",alignItems:"center",gap:"0.5rem",color:"var(--color-text-secondary)"},children:[e.jsx(Ge,{size:18}),"Today's Live Snapshot"]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",justifyContent:"center",gap:"2rem",flexWrap:"wrap"},children:[e.jsxs("div",{style:{width:"160px",height:"160px",position:"relative"},children:[e.jsx(me,{width:"100%",height:"100%",children:e.jsxs(qe,{children:[e.jsxs($e,{data:[{name:"Work",value:g.workScore,color:"#10b981"},{name:"Procrastination",value:g.procrastinationScore,color:"#ef4444"}],dataKey:"value",innerRadius:50,outerRadius:70,startAngle:90,endAngle:-270,paddingAngle:5,children:[e.jsx(ve,{fill:"#10b981"},"work"),e.jsx(ve,{fill:"#ef4444"},"proc")]}),e.jsx(ue,{})]})}),e.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:g.workScore>=50?"#10b981":"#ef4444"},children:[g.workScore,"%"]}),e.jsx("div",{style:{fontSize:"0.6rem",color:"var(--color-text-secondary)"},children:"Focus"})]})]}),e.jsxs("div",{style:{flex:1,minWidth:"150px"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"1rem"},children:[e.jsxs("div",{style:{textAlign:"center",padding:"0.5rem",background:"#f0fdf4",borderRadius:"8px"},children:[e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:"bold",color:"#15803d"},children:g.tasksDoneCount||0}),e.jsx("div",{style:{fontSize:"0.7rem",color:"#166534"},children:"Tasks Done"})]}),e.jsxs("div",{style:{textAlign:"center",padding:"0.5rem",background:"#fafaebb",borderRadius:"8px",border:"1px solid #fef08a"},children:[e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:"bold",color:"#854d0e"},children:g.pointsScored||0}),e.jsx("div",{style:{fontSize:"0.7rem",color:"#854d0e"},children:"Points"})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"0.85rem",color:"var(--color-text-secondary)"},children:[e.jsx("span",{children:"Worked:"}),e.jsxs("strong",{children:[g.workTime||0,"m"]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"0.85rem",color:"var(--color-text-secondary)",marginTop:"0.25rem"},children:[e.jsx("span",{children:"Distracted:"}),e.jsxs("strong",{children:[g.distractionTime||0,"m"]})]})]})]}),g.tomorrowGoal&&e.jsxs("div",{style:{padding:"0.75rem",background:"var(--color-bg-accent)",borderRadius:"var(--radius-md)",marginTop:"1rem"},children:[e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",display:"flex",alignItems:"center",gap:"0.25rem",marginBottom:"0.25rem"},children:[e.jsx(Ee,{size:12}),new Date(g.date).toDateString()===new Date().toDateString()?"Goal for Tomorrow":"Target"]}),e.jsx("div",{style:{fontWeight:500,fontSize:"0.9rem"},children:g.tomorrowGoal})]})]})]})]})})},ar=(i,t={})=>{const s=new Date;let r="night";if(t.overrideTimeOfDay)r=t.overrideTimeOfDay;else{const l=s.getHours();l>=5&&l<12?r="morning":l>=12&&l<17?r="afternoon":l>=17&&l<21&&(r="evening")}const{overrideTimeOfDay:a,...u}=t,n=x(d.USER_MOOD,"neutral");return{event_id:crypto.randomUUID(),user_id:G.currentUser?G.currentUser.uid:"local_user",timestamp:s.toISOString(),date:s.toISOString().split("T")[0],time_of_day:r,event_type:i,mood_before:n,payload:u,synced:!1}},ie=(i,t)=>{const s=ar(i,t),r=x(d.EVENT_LOG,[]);r.push(s),N(d.EVENT_LOG,r),lr()},lr=async()=>{const i=G.currentUser;if(!i)return;const t=x(d.EVENT_LOG,[]),s=t.filter(r=>!r.synced);if(s.length!==0)try{const r=Gt(oe),a=qt(oe,"users",i.uid,"events");s.forEach(n=>{const l=he(a,n.event_id),{synced:c,...h}=n;r.set(l,h)}),await r.commit();const u=t.map(n=>s.find(l=>l.event_id===n.event_id)?{...n,synced:!0}:n);N(d.EVENT_LOG,u),console.log(`Synced ${s.length} events to cloud.`)}catch(r){console.error("Failed to sync events:",r)}},cr=()=>{const i=q(),t=[{id:"focused",label:"Focused",icon:e.jsx(pe,{size:32}),color:"var(--color-success)",desc:"I'm ready to tackle something big."},{id:"low-energy",label:"Low Energy",icon:e.jsx(vt,{size:32}),color:"var(--color-warning)",desc:"I need something small and easy."},{id:"bored",label:"Bored",icon:e.jsx(St,{size:32}),color:"var(--color-text-accent)",desc:"I need to get interested."}],s=r=>{N(d.USER_MOOD,r),ie("mood_update",{mood:r}),i("/tasks")};return e.jsx(P,{children:e.jsxs("div",{className:"container",children:[e.jsx("h2",{style:{textAlign:"center",marginBottom:"1rem"},children:"How are you feeling right now?"}),e.jsx("div",{style:{display:"grid",gap:"1rem"},children:t.map(r=>e.jsxs("button",{onClick:()=>s(r.id),className:"card",style:{display:"flex",alignItems:"center",gap:"1rem",textAlign:"left",width:"100%",border:"1px solid transparent",cursor:"pointer",transition:"transform 0.2s, border-color 0.2s"},onMouseEnter:a=>{a.currentTarget.style.transform="scale(1.02)",a.currentTarget.style.borderColor=r.color},onMouseLeave:a=>{a.currentTarget.style.transform="scale(1)",a.currentTarget.style.borderColor="transparent"},children:[e.jsx("div",{style:{color:r.color},children:r.icon}),e.jsxs("div",{children:[e.jsx("strong",{style:{display:"block",fontSize:"1.1rem"},children:r.label}),e.jsx("span",{style:{fontSize:"0.9rem",color:"var(--color-text-secondary)"},children:r.desc})]})]},r.id))})]})})},dr=()=>{const i=q(),[t,s]=m.useState([]),[r,a]=m.useState(null),[u,n]=m.useState([]),l=c=>{if(window.confirm("Are you sure you want to delete this task?")){const h=t.filter(p=>p.id!==c);s(h);const f=x(d.TASKS,[]).filter(p=>p.id!==c);N(d.TASKS,f)}};return m.useEffect(()=>{const c=x(d.USER_MOOD);a(c);const S=x(d.TASKS,[]).filter(D=>{var g;return!D.completed&&(((g=D.moods)==null?void 0:g.includes(c))||!D.moods||D.moods.length===0)});s(S);const f=x(d.SCHEDULED_TASKS,[]),p=new Date().setHours(0,0,0,0),C=f.filter(D=>{const g=new Date(D.startDate).setHours(0,0,0,0),v=new Date(D.dueDate).setHours(0,0,0,0);return!D.completed&&p>=g&&p<=v});n(C)},[]),e.jsx(P,{children:e.jsxs("div",{className:"container",children:[e.jsxs("button",{onClick:()=>i("/schedule"),style:{background:"transparent",border:"none",color:"var(--color-primary)",display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0",fontSize:"1rem",cursor:"pointer",marginBottom:"1rem"},children:[e.jsx(Y,{size:20})," Back"]}),u.length>0&&e.jsxs("div",{style:{background:"var(--color-bg-accent)",padding:"1rem",borderRadius:"var(--radius-md)",marginBottom:"1.5rem",border:"1px solid var(--color-primary)"},children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"start",color:"var(--color-primary)",marginBottom:"0.5rem"},children:[e.jsx(Z,{size:20,style:{marginTop:"0.1rem"}}),e.jsxs("strong",{style:{display:"block"},children:["Daily Commitments (",u.length,")"]})]}),u.map(c=>e.jsx("div",{style:{marginLeft:"1.75rem",marginBottom:"0.5rem",borderBottom:"1px solid #e2e8f0",paddingBottom:"0.5rem"},children:e.jsxs("span",{style:{color:"var(--color-text-primary)"},children:["Planned to work on ",e.jsx("strong",{children:c.workToComplete})," for the ",e.jsx("strong",{children:c.name}),"."]})},c.id))]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[e.jsx("h2",{children:"Suggested for You"}),e.jsxs("button",{className:"btn-primary",style:{padding:"0.5rem 1rem",display:"flex",alignItems:"center",gap:"0.5rem"},onClick:()=>i("/add-task"),children:[e.jsx(fe,{size:18})," Add Task"]})]}),t.length===0?e.jsxs("div",{style:{textAlign:"center",color:"var(--color-text-secondary)",padding:"2rem"},children:[e.jsxs("p",{children:["No tasks fit your current mood (",r,")."]}),e.jsx("p",{children:"Why not add a small one?"})]}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:t.map(c=>e.jsxs("div",{className:"card",children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start"},children:e.jsxs("div",{children:[e.jsx("h3",{style:{margin:"0 0 0.25rem",fontSize:"1.25rem"},children:c.title}),e.jsxs("p",{style:{fontSize:"0.9rem",marginBottom:"0.5rem"},children:[e.jsx("strong",{children:"Start with:"})," ",c.smallStep]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.85rem",color:"var(--color-text-secondary)"},children:c.time&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{size:16})," ",c.time]})})]})}),e.jsxs("div",{style:{marginTop:"1rem",textAlign:"right"},children:[e.jsx("button",{className:"btn-primary",style:{background:"var(--color-success)",fontSize:"0.9rem"},onClick:()=>i(`/complete/${c.id}`),children:"Task Done (Add Proof)"}),e.jsx("button",{style:{background:"transparent",border:"none",color:"#ef4444",marginLeft:"1rem",cursor:"pointer",padding:"0.5rem"},onClick:()=>l(c.id),"aria-label":"Delete task",children:e.jsx(ge,{size:18})})]})]},c.id))})]})})},mr=()=>{const i=q(),[t,s]=m.useState({title:"",smallStep:"",moods:[],reminderTime:"",frequency:"once",repeatDays:[]}),r=[{id:"focused",label:"Focused"},{id:"low-energy",label:"Low Energy"},{id:"bored",label:"Bored"}],a=n=>{n.preventDefault();const l=x(d.TASKS,[]),c={id:Date.now().toString(),...t,completed:!1,createdAt:new Date().toISOString()};N(d.TASKS,[c,...l]),ie("task_create",{task_id:c.id,title:c.title}),i("/tasks")},u=n=>{s(l=>{const c=l.moods.includes(n)?l.moods.filter(h=>h!==n):[...l.moods,n];return{...l,moods:c}})};return e.jsx(P,{children:e.jsxs("div",{className:"container",children:[e.jsxs("button",{onClick:()=>i("/schedule"),style:{background:"transparent",border:"none",color:"var(--color-primary)",display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0",fontSize:"1rem",cursor:"pointer",marginBottom:"1rem"},children:[e.jsx(Y,{size:20})," Back"]}),e.jsx("h2",{children:"Add a New Task"}),e.jsxs("form",{onSubmit:a,className:"card",children:[e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{children:"Task Name"}),e.jsx("input",{required:!0,value:t.title,onChange:n=>s({...t,title:n.target.value}),placeholder:"e.g. Study Math"})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{children:"Small First Step (Crucial!)"}),e.jsx("input",{required:!0,value:t.smallStep,onChange:n=>s({...t,smallStep:n.target.value}),placeholder:"e.g. Open the textbook to page 50"}),e.jsx("small",{style:{color:"var(--color-text-secondary)"},children:"Just write what you will do in the first 2 minutes."})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{children:"Best for Mood (Optional)"}),e.jsx("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:r.map(n=>e.jsx("button",{type:"button",onClick:()=>u(n.id),style:{padding:"0.5rem 1rem",borderRadius:"var(--radius-full)",border:"1px solid var(--color-primary)",background:t.moods.includes(n.id)?"var(--color-primary)":"transparent",color:t.moods.includes(n.id)?"white":"var(--color-primary)",fontSize:"0.85rem"},children:n.label},n.id))})]}),e.jsxs("div",{style:{marginBottom:"1.5rem",padding:"1rem",background:"var(--color-bg-secondary)",borderRadius:"var(--radius-md)"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem",fontWeight:"bold"},children:[e.jsx(Z,{size:16})," Reminder & frequency"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"0.85rem"},children:"Time"}),e.jsx("input",{type:"time",value:t.reminderTime,onChange:n=>s({...t,reminderTime:n.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"0.85rem"},children:"Frequency"}),e.jsxs("select",{value:t.frequency,onChange:n=>s({...t,frequency:n.target.value}),style:{width:"100%",padding:"0.5rem",borderRadius:"4px",border:"1px solid #cbd5e1"},children:[e.jsx("option",{value:"once",children:"Once (Today)"}),e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"custom",children:"Custom Days"})]})]})]}),t.frequency==="custom"&&e.jsx("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map(n=>e.jsx("button",{type:"button",onClick:()=>{const l=t.repeatDays.includes(n)?t.repeatDays.filter(c=>c!==n):[...t.repeatDays,n];s({...t,repeatDays:l})},style:{padding:"0.25rem 0.5rem",fontSize:"0.75rem",borderRadius:"4px",border:"1px solid var(--color-primary)",background:t.repeatDays.includes(n)?"var(--color-primary)":"white",color:t.repeatDays.includes(n)?"white":"var(--color-primary)"},children:n},n))})]}),e.jsx("button",{type:"submit",className:"btn-primary",style:{width:"100%"},children:"Save Task"})]})]})})},Ne=({value:i,onChange:t})=>e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem",marginTop:"0.5rem"},children:[["15","30","45","60"].map(s=>e.jsxs("button",{type:"button",onClick:()=>t(s),style:{padding:"0.5rem 1rem",borderRadius:"2rem",border:"1px solid var(--color-primary)",background:i===s?"var(--color-primary)":"transparent",color:i===s?"white":"var(--color-primary)",cursor:"pointer",transition:"all 0.2s"},children:[s,"m"]},s)),e.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",placeholder:"Custom (max 600)",value:i,onChange:s=>{const r=s.target.value;(r===""||/^\d+$/.test(r)&&parseInt(r,10)<=600)&&t(r)},style:{width:"120px",padding:"0.5rem",borderRadius:"var(--radius-md)",border:"1px solid #cbd5e1",outlineColor:"var(--color-primary)"}})]}),Se=({value:i,onChange:t,compact:s=!1})=>{const r=[{id:"morning",label:"Morning",icon:e.jsx(Ae,{size:20}),color:"#f59e0b"},{id:"afternoon",label:"Afternoon",icon:e.jsx(bt,{size:20}),color:"#ea580c"},{id:"evening",label:"Evening",icon:e.jsx(Dt,{size:20}),color:"#7c3aed"},{id:"night",label:"Night",icon:e.jsx(Ie,{size:20}),color:"#1e293b"}];return e.jsxs("div",{style:{marginBottom:s?0:"1.5rem"},children:[!s&&e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"500",color:"var(--color-text-secondary)"},children:"When did this happen?"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:s?"repeat(4, auto)":"repeat(4, 1fr)",gap:s?"0.25rem":"0.5rem"},children:r.map(a=>e.jsxs("button",{type:"button",onClick:()=>t(a.id),title:s?a.label:"",style:{display:"flex",flexDirection:s?"row":"column",alignItems:"center",justifyContent:"center",gap:"0.25rem",padding:s?"0.4rem":"0.75rem 0.25rem",borderRadius:"var(--radius-md)",border:`1px solid ${i===a.id?a.color:"transparent"}`,background:i===a.id?`${a.color}15`:"var(--color-bg-secondary)",color:i===a.id?a.color:"var(--color-text-secondary)",cursor:"pointer",transition:"all 0.2s"},children:[a.icon,!s&&e.jsx("span",{style:{fontSize:"0.75rem",fontWeight:i===a.id?"600":"400"},children:a.label})]},a.id))})]})},ur=()=>{const{taskId:i}=Tt(),t=q(),[s,r]=m.useState(null),[a,u]=m.useState(""),[n,l]=m.useState(""),[c,h]=m.useState(null),S=m.useRef(null),f=m.useRef(null),[p,C]=m.useState(!1),[D,g]=m.useState(0),[v,T]=m.useState("morning");m.useEffect(()=>{const b=new Date().getHours();b>=5&&b<12?T("morning"):b>=12&&b<17?T("afternoon"):b>=17&&b<21?T("evening"):T("night")},[]),m.useEffect(()=>{let R=x(d.TASKS,[]).find(L=>L.id===i);if(!R){const M=x(d.SCHEDULED_TASKS,[]).find(I=>String(I.id)===i);M&&(R={...M,title:M.name,smallStep:M.workToComplete||"Scheduled Work",isSchedule:!0})}R&&r(R)},[i]);const O=b=>{const R=b.target.files[0];if(R){const L=new FileReader;L.onloadend=()=>{h(L.result)},L.readAsDataURL(R)}},B=b=>{b.preventDefault();const R=new Date().setHours(0,0,0,0);let L=10;if(s.isSchedule){const I=new Date(s.dueDate).setHours(0,0,0,0);R<=I?L=100:L=10}const M=parseInt(n)||0;if(L+=M,s.isSchedule){const _=x(d.SCHEDULED_TASKS,[]).map(W=>String(W.id)===i?{...W,completed:!0,completedAt:new Date().toISOString(),timeTaken:parseInt(n)||0,proofImage:c,pointsEarned:L}:W);N(d.SCHEDULED_TASKS,_)}else{const _=x(d.TASKS,[]).map(W=>W.id===i?{...W,completed:!0,learning:a,completedAt:new Date().toISOString(),timeTaken:parseInt(n)||0,proofImage:c,pointsEarned:L}:W);N(d.TASKS,_)}Ce(L),st(),ie("task_complete",{task_id:i,task_title:s.title,actual_time_spent:parseInt(n)||0,points_earned:L,has_proof:!!c,learning_note:a,overrideTimeOfDay:v}),g(L),C(!0)};return s?p?e.jsx(P,{children:e.jsxs("div",{className:"container",style:{textAlign:"center",padding:"3rem 1rem"},children:[e.jsx(ye,{size:64,color:"var(--color-success)",style:{margin:"0 auto 1rem"}}),e.jsx("h2",{children:"Well Done!"}),e.jsx("p",{children:"You started despite resistance. That matters."}),e.jsxs("div",{style:{margin:"2rem 0",padding:"1.5rem",background:"var(--color-bg-accent)",borderRadius:"var(--radius-lg)"},children:[e.jsxs("h3",{style:{margin:0,color:"var(--color-primary)"},children:["+",D," Focus Points"]}),e.jsx("p",{style:{margin:"0.5rem 0 0"},children:"Streak Updated!"})]}),e.jsx("button",{className:"btn-primary",onClick:()=>t("/"),children:"Back Home"})]})}):e.jsx(P,{children:e.jsxs("div",{className:"container",children:[e.jsxs("h2",{children:['Complete "',s.title,'"']}),e.jsx("div",{className:"card",children:e.jsxs("form",{onSubmit:B,children:[e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{children:"Time Taken (minutes)"}),e.jsx(Ne,{value:n,onChange:l})]}),e.jsx(Se,{value:v,onChange:T}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{children:"What did you learn or do? (Optional)"}),e.jsx("textarea",{value:a,onChange:b=>u(b.target.value),placeholder:"I learned that starting wasn't so bad...",rows:2})]}),e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem"},children:"Upload Proof (Optional)"}),e.jsx("input",{type:"file",accept:"image/*",ref:S,onChange:O,style:{display:"none"}}),e.jsx("input",{type:"file",accept:"image/*",capture:"environment",id:"cameraInput",ref:f,onChange:O,style:{display:"none"}}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{onClick:()=>{var b;return(b=S.current)==null?void 0:b.click()},style:{border:"2px dashed #cbd5e1",borderRadius:"var(--radius-md)",padding:"1.5rem",textAlign:"center",color:"var(--color-text-secondary)",cursor:"pointer",background:c?"#f0fdf4":"transparent"},children:[e.jsx(Ve,{size:24,style:{marginBottom:"0.5rem"}}),e.jsx("div",{children:"Upload Image"})]}),e.jsxs("div",{onClick:()=>{var b;return(b=f.current)==null?void 0:b.click()},style:{border:"2px dashed #cbd5e1",borderRadius:"var(--radius-md)",padding:"1.5rem",textAlign:"center",color:"var(--color-text-secondary)",cursor:"pointer",background:c?"#f0fdf4":"transparent"},children:[e.jsx(Je,{size:24,style:{marginBottom:"0.5rem"}}),e.jsx("div",{children:"Take Photo"})]})]}),c&&e.jsx("div",{style:{marginTop:"0.5rem",fontSize:"0.875rem",color:"var(--color-success)",textAlign:"center"},children:"Proof Attached!"})]}),e.jsx("button",{type:"submit",className:"btn-primary",style:{width:"100%",opacity:n?1:.5,cursor:n?"pointer":"not-allowed"},disabled:!n,children:"Mark as Completed"})]})})]})}):e.jsx(P,{children:e.jsx("div",{children:"Loading..."})})},pr=()=>{const i=q(),[t,s]=m.useState([]),[r,a]=m.useState([]),[u,n]=m.useState(null),[l,c]=m.useState(""),[h,S]=m.useState("morning"),[f,p]=m.useState(!1),[C,D]=m.useState(!1),[g,v]=m.useState(!1),[T,O]=m.useState(""),[B,b]=m.useState(""),[R,L]=m.useState(null),M=m.useRef(null),I=m.useRef(null),[_,W]=m.useState("morning"),[A,y]=m.useState({name:"",workToComplete:"",startDate:"",dueDate:"",reminderTime:"",frequency:"once",repeatDays:[]}),[j,F]=m.useState({title:"",smallStep:"",moods:[],reminderTime:"",frequency:"once",repeatDays:[]}),[X,$]=m.useState(null),te=[{id:"focused",label:"Focused"},{id:"low-energy",label:"Low Energy"},{id:"bored",label:"Bored"}];m.useEffect(()=>{s(x(d.SCHEDULED_TASKS,[])),a(x(d.TASKS,[]))},[]);const V=o=>{if(o.preventDefault(),!u||!l)return;const w=parseInt(l);if(isNaN(w)||w<=0)return;const E={id:Date.now().toString(),taskId:u.id,taskTitle:u.title||u.name,duration:w,timeOfDay:h,date:new Date().toISOString()},K=x(d.WORK_LOGS,[]);N(d.WORK_LOGS,[...K,E]),Ce(w),n(null),c(""),alert(`Logged ${w} mins of work! Keep it up.`)},xe=o=>{if(o.preventDefault(),X){const w=t.map(E=>E.id===X?{...E,...A}:E);N(d.SCHEDULED_TASKS,w),s(w),$(null)}else{const w=[...t,{id:Date.now(),...A}];N(d.SCHEDULED_TASKS,w),s(w)}p(!1),p(!1),y({name:"",workToComplete:"",startDate:"",dueDate:"",reminderTime:"",frequency:"once",repeatDays:[]})},re=o=>{y({name:o.name,workToComplete:o.workToComplete||"",startDate:o.startDate,dueDate:o.dueDate,reminderTime:o.reminderTime||"",frequency:o.frequency||"once",repeatDays:o.repeatDays||[]}),$(o.id),p(!0),D(!1),v(!1)},se=o=>{o.preventDefault();const E=[{id:Date.now().toString(),...j,completed:!1,createdAt:new Date().toISOString()},...r];N(d.TASKS,E),a(E),D(!1),D(!1),F({title:"",smallStep:"",moods:[],reminderTime:"",frequency:"once",repeatDays:[]})},ne=o=>{if(window.confirm("Delete this daily task?")){const w=r.filter(E=>E.id!==o);a(w),N(d.TASKS,w)}},ae=o=>{if(window.confirm("Cancel this future plan?")){const w=t.filter(E=>E.id!==o);s(w),N(d.SCHEDULED_TASKS,w)}},le=o=>{F(w=>{const E=w.moods.includes(o)?w.moods.filter(K=>K!==o):[...w.moods,o];return{...w,moods:E}})},Q=o=>{const w=o.target.files[0];if(w){const E=new FileReader;E.onloadend=()=>{L(E.result)},E.readAsDataURL(w)}},z=o=>{o.preventDefault();const E=10+(parseInt(B)||0),K=x(d.TASKS,[]),ee={id:Date.now().toString(),title:T,smallStep:"Ad-hoc Logged",time:B,completed:!0,completedAt:new Date().toISOString(),timeTaken:parseInt(B)||0,proofImage:R,isAdhoc:!0,pointsEarned:E};N(d.TASKS,[ee,...K]),a([ee,...K]),Ce(E),st(),ie("task_complete",{task_id:ee.id,task_title:ee.title,actual_time_spent:parseInt(B)||0,points_earned:E,has_proof:!!R,is_adhoc:!0}),alert(`Saved! +${E} Points.`),v(!1),O(""),b(""),L(null)};return e.jsx(P,{children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"2rem"},children:[e.jsxs("button",{onClick:()=>i("/"),style:{background:"var(--color-bg-secondary)",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",color:"var(--color-primary)",padding:"0.5rem 1rem",borderRadius:"2rem",fontWeight:"500",marginRight:"1rem"},children:[e.jsx(Y,{size:18})," Back"]}),e.jsx("h2",{style:{margin:0},children:"Planning Hub"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"3rem"},children:[e.jsxs("div",{className:"card",style:{textAlign:"center",cursor:"pointer",border:C?"2px solid var(--color-primary)":"1px solid transparent",transition:"all 0.2s",padding:"2rem 1rem"},onClick:()=>{D(!C),p(!1),v(!1)},children:[e.jsx("div",{style:{background:"var(--color-bg-accent)",width:"48px",height:"48px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 1rem",color:"var(--color-primary)"},children:e.jsx(pe,{size:24})}),e.jsx("h3",{style:{fontSize:"1.2rem",margin:"0 0 0.5rem"},children:"Add Task"}),e.jsx("p",{style:{fontSize:"0.9rem",color:"var(--color-text-secondary)",margin:0},children:"For immediate work today. Small steps."})]}),e.jsxs("div",{className:"card",style:{textAlign:"center",cursor:"pointer",border:f?"2px solid var(--color-primary)":"1px solid transparent",padding:"2rem 1rem"},onClick:()=>{p(!f),D(!1),v(!1)},children:[e.jsx("div",{style:{background:"#f0f9ff",width:"48px",height:"48px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 1rem",color:"#0284c7"},children:e.jsx(Ee,{size:24})}),e.jsx("h3",{style:{fontSize:"1.2rem",margin:"0 0 0.5rem"},children:"Schedule Future Task"}),e.jsx("p",{style:{fontSize:"0.9rem",color:"var(--color-text-secondary)",margin:0},children:"Plan ahead to reduce uncertainty."})]})]}),C&&e.jsxs("div",{style:{animation:"fadeIn 0.3s ease-in-out"},children:[e.jsx("h3",{style:{marginBottom:"1rem"},children:"Add a New Task"}),e.jsxs("form",{onSubmit:se,className:"card",style:{marginBottom:"3rem",borderLeft:"4px solid var(--color-primary)"},children:[e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{children:"Task Name"}),e.jsx("input",{required:!0,value:j.title,onChange:o=>F({...j,title:o.target.value}),placeholder:"e.g. Study Math",autoFocus:!0})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{children:"Small First Step (Crucial!)"}),e.jsx("input",{required:!0,value:j.smallStep,onChange:o=>F({...j,smallStep:o.target.value}),placeholder:"e.g. Open the textbook to page 50"}),e.jsx("small",{style:{color:"var(--color-text-secondary)"},children:"Just write what you will do in the first 2 minutes."})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{children:"Best for Mood (Optional)"}),e.jsx("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:te.map(o=>e.jsx("button",{type:"button",onClick:()=>le(o.id),style:{padding:"0.5rem 1rem",borderRadius:"var(--radius-full)",border:"1px solid var(--color-primary)",background:j.moods.includes(o.id)?"var(--color-primary)":"transparent",color:j.moods.includes(o.id)?"white":"var(--color-primary)",fontSize:"0.85rem"},children:o.label},o.id))})]}),e.jsxs("div",{style:{marginBottom:"1.5rem",padding:"1rem",background:"var(--color-bg-secondary)",borderRadius:"var(--radius-md)"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem",fontWeight:"bold"},children:[e.jsx(Z,{size:16})," Reminder & frequency"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"0.85rem"},children:"Time"}),e.jsx("input",{type:"time",value:j.reminderTime,onChange:o=>F({...j,reminderTime:o.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"0.85rem"},children:"Frequency"}),e.jsxs("select",{value:j.frequency,onChange:o=>F({...j,frequency:o.target.value}),style:{width:"100%",padding:"0.5rem",borderRadius:"4px",border:"1px solid #cbd5e1"},children:[e.jsx("option",{value:"once",children:"Once (Today)"}),e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"custom",children:"Custom Days"})]})]})]}),j.frequency==="custom"&&e.jsx("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map(o=>e.jsx("button",{type:"button",onClick:()=>{const w=j.repeatDays.includes(o)?j.repeatDays.filter(E=>E!==o):[...j.repeatDays,o];F({...j,repeatDays:w})},style:{padding:"0.25rem 0.5rem",fontSize:"0.75rem",borderRadius:"4px",border:"1px solid var(--color-primary)",background:j.repeatDays.includes(o)?"var(--color-primary)":"white",color:j.repeatDays.includes(o)?"white":"var(--color-primary)"},children:o},o))})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem"},children:[e.jsx("button",{type:"button",onClick:()=>D(!1),className:"btn-secondary",style:{flex:1},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",style:{flex:1},children:"Save Task"})]})]})]}),f&&e.jsxs("div",{style:{animation:"fadeIn 0.3s ease-in-out"},children:[e.jsx("h3",{style:{marginBottom:"1rem"},children:X?"Edit Plan":"New Future Plan"}),e.jsxs("form",{onSubmit:xe,className:"card",style:{marginBottom:"3rem",borderLeft:"4px solid #0284c7"},children:[e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{children:"Task Name"}),e.jsx("input",{required:!0,value:A.name,onChange:o=>y({...A,name:o.target.value}),autoFocus:!0})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{children:"Work to Complete"}),e.jsx("input",{value:A.workToComplete,onChange:o=>y({...A,workToComplete:o.target.value}),placeholder:"e.g. Read Chapters 1-3"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{children:"Start Date"}),e.jsx("input",{type:"date",required:!0,value:A.startDate,onChange:o=>y({...A,startDate:o.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Due Date"}),e.jsx("input",{type:"date",required:!0,value:A.dueDate,onChange:o=>y({...A,dueDate:o.target.value})})]})]}),e.jsxs("div",{style:{marginBottom:"1.5rem",padding:"1rem",background:"var(--color-bg-secondary)",borderRadius:"var(--radius-md)"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem",fontWeight:"bold"},children:[e.jsx(Z,{size:16})," Daily Reminder"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"0.85rem"},children:"Time"}),e.jsx("input",{type:"time",value:A.reminderTime,onChange:o=>y({...A,reminderTime:o.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"0.85rem"},children:"Working Days"}),e.jsxs("select",{value:A.frequency,onChange:o=>y({...A,frequency:o.target.value}),style:{width:"100%",padding:"0.5rem",borderRadius:"4px",border:"1px solid #cbd5e1"},children:[e.jsx("option",{value:"once",children:"Every Day (Default)"}),e.jsx("option",{value:"daily",children:"Every Day"}),e.jsx("option",{value:"custom",children:"Custom Days"})]})]})]}),A.frequency==="custom"&&e.jsx("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map(o=>e.jsx("button",{type:"button",onClick:()=>{const w=A.repeatDays.includes(o)?A.repeatDays.filter(E=>E!==o):[...A.repeatDays,o];y({...A,repeatDays:w})},style:{padding:"0.25rem 0.5rem",fontSize:"0.75rem",borderRadius:"4px",border:"1px solid var(--color-primary)",background:A.repeatDays.includes(o)?"var(--color-primary)":"white",color:A.repeatDays.includes(o)?"white":"var(--color-primary)"},children:o},o))})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem"},children:[e.jsx("button",{type:"button",onClick:()=>p(!1),className:"btn-secondary",style:{flex:1},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",style:{flex:1},children:"Save Plan"})]})]})]}),g&&e.jsxs("div",{style:{animation:"fadeIn 0.3s ease-in-out"},children:[e.jsx("h3",{style:{marginBottom:"1rem"},children:"Log Unplanned Work"}),e.jsxs("form",{onSubmit:z,className:"card",style:{marginBottom:"3rem",borderLeft:"4px solid #8b5cf6"},children:[e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{children:"What did you do?"}),e.jsx("input",{required:!0,value:T,onChange:o=>O(o.target.value),placeholder:"e.g. Helper a friend",autoFocus:!0})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{children:"Time Taken (minutes)"}),e.jsx(Ne,{value:B,onChange:b})]}),e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem"},children:"Upload Proof (Optional)"}),e.jsx("input",{type:"file",accept:"image/*",ref:M,onChange:Q,style:{display:"none"}}),e.jsx("input",{type:"file",accept:"image/*",capture:"environment",ref:I,onChange:Q,style:{display:"none"}}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{onClick:()=>{var o;return(o=M.current)==null?void 0:o.click()},style:{border:"2px dashed #cbd5e1",borderRadius:"var(--radius-md)",padding:"1rem",textAlign:"center",cursor:"pointer",background:R?"#f0fdf4":"transparent"},children:[e.jsx(Ve,{size:24,style:{marginBottom:"0.5rem"}}),e.jsx("div",{children:"Upload"})]}),e.jsxs("div",{onClick:()=>{var o;return(o=I.current)==null?void 0:o.click()},style:{border:"2px dashed #cbd5e1",borderRadius:"var(--radius-md)",padding:"1rem",textAlign:"center",cursor:"pointer",background:R?"#f0fdf4":"transparent"},children:[e.jsx(Je,{size:24,style:{marginBottom:"0.5rem"}}),e.jsx("div",{children:"Camera"})]})]}),R&&e.jsx("div",{style:{marginTop:"0.5rem",fontSize:"0.875rem",color:"var(--color-success)",textAlign:"center"},children:"Proof Attached!"})]}),e.jsx(Se,{value:_,onChange:W}),e.jsxs("div",{style:{display:"flex",gap:"1rem"},children:[e.jsx("button",{type:"button",onClick:()=>v(!1),className:"btn-secondary",style:{flex:1},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",style:{flex:1,opacity:B?1:.5,cursor:B?"pointer":"not-allowed"},disabled:!B,children:"Save Work"})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1.5rem"},children:[e.jsx(wt,{size:20,className:"text-secondary"}),e.jsx("h3",{style:{margin:0,color:"var(--color-text-secondary)"},children:"Your Plans"}),e.jsx("div",{style:{flex:1}}),e.jsx("button",{onClick:()=>{v(!g),D(!1),p(!1)},style:{background:"var(--color-bg-secondary)",border:"none",padding:"0.5rem 1rem",borderRadius:"var(--radius-full)",color:"var(--color-primary)",fontSize:"0.85rem",fontWeight:"500",cursor:"pointer"},children:"+ Log Other Task"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[r.length>0&&r.some(o=>!o.completed)&&e.jsx("h4",{style:{margin:"1rem 0 0.5rem",color:"var(--color-primary)",borderBottom:"1px solid #e2e8f0",paddingBottom:"0.25rem"},children:"Daily Commitments"}),r.filter(o=>!o.completed).map(o=>e.jsxs("div",{className:"card",style:{borderLeft:"4px solid var(--color-warning)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.25rem"},children:[e.jsx("h3",{style:{margin:0},children:o.title}),e.jsx("span",{style:{fontSize:"0.75rem",background:"#fef3c7",color:"#d97706",padding:"0.1rem 0.4rem",borderRadius:"4px"},children:"Now"})]}),e.jsx("p",{style:{margin:"0 0 0.5rem",color:"var(--color-text-primary)"},children:o.smallStep})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"0.2rem"},children:[o.reminderTime&&e.jsxs("span",{style:{fontSize:"0.7rem",color:"var(--color-primary)",display:"flex",alignItems:"center",gap:"0.2rem"},children:[e.jsx(Z,{size:10})," ",o.reminderTime]}),o.frequency==="custom"&&e.jsx("span",{style:{fontSize:"0.65rem",color:"var(--color-text-secondary)"},children:o.repeatDays.join(", ")}),o.frequency==="daily"&&e.jsx("span",{style:{fontSize:"0.65rem",color:"var(--color-text-secondary)"},children:"Daily"})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",marginTop:"1rem",paddingTop:"0.75rem",borderTop:"1px solid #eee",gap:"0.5rem"},children:[e.jsxs("button",{className:"btn-primary",style:{background:"var(--color-success)",fontSize:"0.85rem",padding:"0.5rem 1rem"},onClick:()=>i(`/complete/${o.id}`),children:[e.jsx(ye,{size:16,style:{marginRight:"0.25rem"}})," Task Done"]}),e.jsxs("button",{style:{background:"#fee2e2",border:"none",color:"#ef4444",cursor:"pointer",padding:"0.5rem 1rem",borderRadius:"2rem",fontSize:"0.85rem",display:"flex",alignItems:"center",gap:"0.25rem"},onClick:()=>ne(o.id),children:[e.jsx(ge,{size:16})," Delete"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--color-text-secondary)",marginLeft:"auto"},children:o.time&&`${o.time}m`})]})]},o.id)),t.length>0&&e.jsx("h4",{style:{margin:"1.5rem 0 0.5rem",color:"#0284c7",borderBottom:"1px solid #e2e8f0",paddingBottom:"0.25rem"},children:"Future Schedule"}),t.map(o=>{const w=new Date().setHours(0,0,0,0),E=new Date(o.startDate).setHours(0,0,0,0),K=new Date(o.dueDate).setHours(0,0,0,0),ee=w>=E&&w<=K;return K<w||o.completed?null:e.jsxs("div",{className:"card",style:{borderLeft:"4px solid var(--color-primary)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start"},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{margin:"0 0 0.25rem"},children:o.name}),e.jsx("p",{style:{margin:"0 0 0.5rem",color:"var(--color-text-primary)"},children:o.workToComplete}),o.reminderTime&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--color-primary)",display:"flex",alignItems:"center",gap:"0.4rem",marginTop:"0.2rem"},children:[e.jsx(Z,{size:12}),"Reminder: ",o.reminderTime,o.frequency==="custom"&&` (${o.repeatDays.join(", ")})`,o.frequency==="daily"&&" (Daily)"]})]}),ee&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",color:"var(--color-primary)",fontSize:"0.8rem",fontWeight:"bold",background:"var(--color-bg-accent)",padding:"0.25rem 0.5rem",borderRadius:"var(--radius-md)"},children:[e.jsx(Z,{size:14}),"Active Today"]})]}),e.jsxs("div",{style:{marginTop:"0.5rem",marginBottom:"1rem",fontSize:"0.85rem",color:"var(--color-text-secondary)"},children:[e.jsxs("span",{style:{marginRight:"1rem"},children:["Start: ",o.startDate]}),e.jsxs("span",{children:["Due: ",o.dueDate]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",flexWrap:"wrap",gap:"0.75rem",marginTop:"1rem",paddingTop:"1rem",borderTop:"1px solid #e2e8f0"},children:[e.jsxs("button",{className:"btn-secondary",style:{fontSize:"0.8rem",padding:"0.5rem 1rem",display:"flex",alignItems:"center",gap:"0.25rem"},onClick:()=>n(o),children:[e.jsx(pe,{size:14})," Done some work"]}),e.jsxs("button",{className:"btn-primary",style:{background:"var(--color-success)",fontSize:"0.85rem",padding:"0.5rem 1rem",display:"flex",alignItems:"center",gap:"0.25rem"},onClick:()=>i(`/complete/${o.id}`),children:[e.jsx(ye,{size:16})," Task Done"]}),e.jsxs("button",{onClick:()=>re(o),style:{background:"#fef3c7",color:"#d97706",border:"none",cursor:"pointer",padding:"0.5rem 1rem",borderRadius:"2rem",fontSize:"0.8rem",display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx(Ze,{size:14})," Edit"]}),e.jsxs("button",{style:{background:"#fee2e2",border:"none",color:"#ef4444",cursor:"pointer",padding:"0.5rem 1rem",borderRadius:"2rem",fontSize:"0.8rem",display:"flex",alignItems:"center",gap:"0.25rem"},onClick:()=>ae(o.id),children:[e.jsx(ge,{size:14})," Delete"]})]}),(u==null?void 0:u.id)===o.id&&e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",background:"var(--color-bg-secondary)",borderRadius:"var(--radius-md)"},children:[e.jsx("h4",{style:{margin:"0 0 0.5rem"},children:"Log Work (Not Done Yet)"}),e.jsxs("form",{onSubmit:V,style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",placeholder:"Mins",value:l,onChange:_e=>{const J=_e.target.value;(J===""||/^\d+$/.test(J)&&parseInt(J,10)<=600)&&c(J)},style:{width:"80px",padding:"0.5rem",borderRadius:"4px",border:"1px solid #cbd5e1"},autoFocus:!0}),e.jsx(Se,{value:h,onChange:S,compact:!0})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsxs("button",{type:"submit",className:"btn-primary",style:{padding:"0.25rem 0.75rem",fontSize:"0.85rem",flex:1,opacity:l?1:.5},disabled:!l,children:[e.jsx(kt,{size:14})," Save"]}),e.jsx("button",{type:"button",onClick:()=>{n(null),c("")},style:{background:"transparent",border:"none",cursor:"pointer",color:"var(--color-text-secondary)"},children:e.jsx(Xe,{size:18})})]})]})]})]},o.id)}),r.length===0&&t.length===0&&e.jsx("p",{style:{textAlign:"center",padding:"2rem",background:"var(--color-bg-secondary)",borderRadius:"var(--radius-md)"},children:"No plans yet. Clear mind, clear path."})]})]})]})})},gr=()=>{const i=q(),[t,s]=m.useState(0),[r,a]=m.useState(0),[u,n]=m.useState(""),[l,c]=m.useState([]),[h,S]=m.useState([]),[f,p]=m.useState([]),[C,D]=m.useState(!1),[g,v]=m.useState(0),[T,O]=m.useState(0),[B,b]=m.useState(0),[R,L]=m.useState(0);m.useEffect(()=>{const I=new Date().setHours(0,0,0,0),W=x(d.DISTRACTION_LOGS,[]).filter(z=>new Date(z.date).setHours(0,0,0,0)===I);c(W);const A=W.reduce((z,o)=>z+parseInt(o.duration||0),0);O(A);const y=x(d.TASKS,[]),j=x(d.SCHEDULED_TASKS,[]),F=y.filter(z=>!z.completed||!z.completedAt?!1:new Date(z.completedAt).setHours(0,0,0,0)===I),X=j.filter(z=>!z.completed||!z.completedAt?!1:new Date(z.completedAt).setHours(0,0,0,0)===I),$=[...F,...X];S($);const V=x(d.WORK_LOGS,[]).filter(z=>new Date(z.date).setHours(0,0,0,0)===I);p(V);const xe=$.reduce((z,o)=>z+(parseInt(o.timeTaken)||0),0),re=V.reduce((z,o)=>z+parseInt(o.duration||0),0),se=xe+re;v(se);const ne=$.length+V.length;b(ne);const ae=$.reduce((z,o)=>o.pointsEarned!==void 0?z+o.pointsEarned:z+10+(parseInt(o.timeTaken)||0),0),le=V.reduce((z,o)=>z+(parseInt(o.duration)||0),0);L(ae+le);const Q=se+A;if(Q>0){const z=Math.round(A/Q*100);s(z),a(100-z)}else a(0),s(0)},[]);const M=I=>{I.preventDefault();const _=x(d.REFLECTIONS,[]),W={id:Date.now(),date:new Date().toISOString(),procrastinationScore:t,workScore:r,tomorrowGoal:u,distractionCount:l.length,distractionTime:T,tasksDoneCount:B,taskTime:g,pointsScored:R};N(d.REFLECTIONS,[W,..._]),ie("diary_entry",{procrastination_score:t,work_score:r,tomorrow_goal:u,total_distraction_time:T,total_work_time:g}),D(!0)};return C?e.jsx(P,{children:e.jsxs("div",{className:"container",style:{textAlign:"center",paddingTop:"3rem"},children:[e.jsx("div",{style:{fontSize:"4rem",marginBottom:"1rem"},children:"üåô"}),e.jsx("h2",{children:"Reflection Saved"}),e.jsx("p",{children:"Rest well. Tomorrow is a fresh start."}),e.jsx("button",{className:"btn-primary",onClick:()=>i("/"),style:{marginTop:"2rem"},children:"Back Home"}),e.jsxs("div",{style:{marginTop:"2rem",padding:"1.5rem",background:"var(--color-bg-accent)",borderRadius:"var(--radius-lg)",textAlign:"left"},children:[e.jsx("h3",{style:{fontSize:"1.1rem",marginTop:0},children:"Target for Tomorrow:"}),e.jsx("p",{style:{fontSize:"1.2rem",color:"var(--color-primary)",fontWeight:600},children:u})]})]})}):e.jsx(P,{children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"2rem"},children:[e.jsxs("button",{onClick:()=>i("/"),style:{background:"var(--color-bg-secondary)",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",color:"var(--color-primary)",padding:"0.5rem 1rem",borderRadius:"2rem",fontWeight:"500",marginRight:"1rem"},children:[e.jsx(Y,{size:18})," Back"]}),e.jsx("h2",{style:{margin:0},children:"Today's Reflection"})]}),e.jsxs("form",{onSubmit:M,children:[e.jsxs("div",{className:"card",style:{marginBottom:"1.5rem",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-around",flexWrap:"wrap"},children:[e.jsxs("div",{style:{width:"180px",height:"180px",position:"relative"},children:[e.jsx(me,{width:"100%",height:"100%",children:e.jsxs(qe,{children:[e.jsxs($e,{data:[{name:"Work",value:r,color:"#10b981"},{name:"Procrastination",value:t,color:"#ef4444"}],dataKey:"value",innerRadius:60,outerRadius:80,startAngle:90,endAngle:-270,paddingAngle:5,children:[e.jsx(ve,{fill:"#10b981"},"work"),e.jsx(ve,{fill:"#ef4444"},"proc")]}),e.jsx(ue,{})]})}),e.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:r>=50?"#10b981":"#ef4444"},children:[r,"%"]}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--color-text-secondary)"},children:"Focus"})]})]}),e.jsxs("div",{style:{textAlign:"left",padding:"1rem"},children:[e.jsx("h3",{style:{margin:"0 0 0.5rem",fontSize:"1.2rem"},children:"Day Summary"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.9rem"},children:[e.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"50%",background:"#10b981"}}),e.jsxs("span",{children:["Productive: ",e.jsxs("strong",{children:[g,"m"]})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.9rem"},children:[e.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"50%",background:"#ef4444"}}),e.jsxs("span",{children:["Distracted: ",e.jsxs("strong",{children:[T,"m"]})]})]}),e.jsxs("div",{style:{marginTop:"0.5rem",fontSize:"0.85rem",color:"var(--color-text-secondary)"},children:["Tasks Done: ",e.jsx("strong",{children:B})," | Points: ",e.jsx("strong",{children:R})]})]})]})]}),e.jsxs("div",{className:"card",style:{marginBottom:"2rem"},children:[e.jsxs("h3",{style:{fontSize:"1.1rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(Ge,{size:18})," Activity Log"]}),h.length===0&&l.length===0&&f.length===0?e.jsx("p",{style:{color:"var(--color-text-secondary)",fontStyle:"italic",textAlign:"center",padding:"1rem"},children:"No activity recorded yet."}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[h.map((I,_)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--color-bg-secondary)"},children:[e.jsx("div",{style:{padding:"0.5rem",borderRadius:"50%",background:"#dcfce7",color:"#15803d"},children:e.jsx(ye,{size:16})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:500},children:I.title||I.name}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--color-text-secondary)"},children:"Completed Task"})]}),e.jsxs("div",{style:{fontWeight:"bold",color:"#15803d"},children:[I.timeTaken||0,"m"]})]},`task-${_}`)),f.map((I,_)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--color-bg-secondary)"},children:[e.jsx("div",{style:{padding:"0.5rem",borderRadius:"50%",background:"#dbeafe",color:"#1d4ed8"},children:e.jsx(Ye,{size:16})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:500},children:I.taskTitle}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--color-text-secondary)"},children:"Work Session"})]}),e.jsxs("div",{style:{fontWeight:"bold",color:"#1d4ed8"},children:[I.duration,"m"]})]},`log-${_}`)),l.map((I,_)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--color-bg-secondary)"},children:[e.jsx("div",{style:{padding:"0.5rem",borderRadius:"50%",background:"#fee2e2",color:"#b91c1c"},children:e.jsx(ze,{size:16})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:500},children:I.app}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--color-text-secondary)"},children:I.reasons.join(", ")})]}),e.jsxs("div",{style:{fontWeight:"bold",color:"#b91c1c"},children:[I.duration,"m"]})]},`dist-${_}`))]})]}),e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx(Ct,{size:18})," Goal for Tomorrow"]}),e.jsx("input",{required:!0,value:u,onChange:I=>n(I.target.value),placeholder:"e.g. Finish the Math Chapter without phone",style:{width:"100%",padding:"0.75rem",borderRadius:"var(--radius-md)",border:"1px solid #cbd5e1"}})]}),e.jsx("button",{type:"submit",className:"btn-primary",style:{width:"100%",padding:"1rem"},children:"Save & Close Day"})]})]})})},yr=()=>{const i=q(),[t,s]=m.useState("initial"),[r,a]=m.useState([]),[u,n]=m.useState(""),[l,c]=m.useState(""),[h,S]=m.useState([]),[f,p]=m.useState(null),[C,D]=m.useState(null),[g,v]=m.useState([]),[T,O]=m.useState(""),[B,b]=m.useState("morning");m.useEffect(()=>{const y=new Date().getHours();y>=5&&y<12?b("morning"):y>=12&&y<17?b("afternoon"):y>=17&&y<21?b("evening"):b("night")},[]),m.useEffect(()=>{const y=x("sp_distraction_types",[]);a(y)},[]);const R=()=>{if(!u)return;let y;f?y=r.map(j=>j.id===f?{...j,name:u,reasons:h.length>0?h:["General"]}:j):y=[...r,{id:Date.now(),name:u,reasons:h.length>0?h:["General"]}],N("sp_distraction_types",y),a(y),n(""),S([]),c(""),p(null),s("initial")},L=y=>{n(y.name),S(y.reasons),p(y.id)},M=y=>{if(window.confirm("Delete this distraction type?")){const j=r.filter(F=>F.id!==y);a(j),N("sp_distraction_types",j),f===y&&(p(null),n(""),S([]))}},I=()=>{l&&(S([...h,l]),c(""))},_=y=>{y.preventDefault();const j=x(d.DISTRACTION_LOGS,[]),F={id:Date.now(),app:C.name,reasons:g,duration:T,date:new Date().toISOString()};N(d.DISTRACTION_LOGS,[F,...j]),ie("distraction_log",{app:C.name,reasons:g,duration:parseInt(T)||0,overrideTimeOfDay:B}),s("success")},W=y=>{g.includes(y)?v(g.filter(j=>j!==y)):v([...g,y])},A=()=>{D(null),v([]),O("")};return t==="calm"?e.jsx(P,{children:e.jsxs("div",{className:"container",style:{textAlign:"center",paddingTop:"4rem"},children:[e.jsx("div",{style:{fontSize:"4rem",marginBottom:"1rem"},children:"üåø"}),e.jsx("h2",{children:"Great Job!"}),e.jsx("p",{children:"Focusing on your improvement is the best gift you can give yourself."}),e.jsx("button",{className:"btn-primary",onClick:()=>s("initial"),style:{marginTop:"2rem"},children:"Back"})]})}):t==="success"?e.jsx(P,{children:e.jsxs("div",{className:"container",style:{textAlign:"center",paddingTop:"4rem"},children:[e.jsx("h2",{children:"Logged."}),e.jsx("p",{children:"Awareness is the first step. Use this data tomorrow."}),e.jsx("button",{className:"btn-primary",onClick:()=>{s("initial"),A()},style:{marginTop:"2rem"},children:"Done"})]})}):t==="config"?e.jsx(P,{children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h2",{children:f?"Edit Distraction":"Add Distraction"}),e.jsx("button",{onClick:()=>s("initial"),style:{background:"none",border:"none",cursor:"pointer"},children:e.jsx(Xe,{})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{children:"Distraction Name"}),e.jsx("input",{value:u,onChange:y=>n(y.target.value),placeholder:"e.g. YouTube Shorts"})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{children:"Possible Reasons"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx("input",{value:l,onChange:y=>c(y.target.value),placeholder:"e.g. Boredom"}),e.jsx("button",{type:"button",onClick:I,className:"btn-primary",style:{padding:"0.5rem"},children:e.jsx(fe,{size:16})})]}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem"},children:h.map((y,j)=>e.jsx("span",{style:{background:"#f1f5f9",padding:"0.25rem 0.5rem",borderRadius:"4px",fontSize:"0.85rem"},children:y},j))})]}),e.jsx("button",{className:"btn-primary",onClick:R,style:{width:"100%"},children:f?"Update Distraction":"Save Distraction"})]}),e.jsxs("div",{style:{marginTop:"2rem"},children:[e.jsx("h3",{children:"Manage Distractions"}),e.jsxs("div",{style:{display:"grid",gap:"0.5rem"},children:[r.map(y=>e.jsxs("div",{style:{padding:"1rem",background:"var(--color-bg-secondary)",borderRadius:"var(--radius-md)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontWeight:"500"},children:y.name}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{onClick:()=>L(y),style:{background:"none",border:"none",cursor:"pointer",color:"var(--color-primary)"},children:e.jsx(Ze,{size:18})}),e.jsx("button",{onClick:()=>M(y.id),style:{background:"none",border:"none",cursor:"pointer",color:"#ef4444"},children:e.jsx(ge,{size:18})})]})]},y.id)),r.length===0&&e.jsx("p",{style:{color:"var(--color-text-secondary)"},children:"No distractions added yet."})]})]})]})}):t==="logging"?e.jsx(P,{children:e.jsxs("div",{className:"container",children:[e.jsxs("button",{onClick:()=>{s("initial"),A()},style:{background:"var(--color-bg-secondary)",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",color:"var(--color-primary)",padding:"0.5rem 1rem",borderRadius:"2rem",fontWeight:"500",marginBottom:"1rem"},children:[e.jsx(Y,{size:18})," Back"]}),e.jsx("h2",{children:"Log Distraction"}),C?e.jsxs("form",{onSubmit:_,className:"card",children:[e.jsx("h3",{style:{marginTop:0},children:C.name}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{children:"Why did you check it? (Select all that apply)"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem",marginTop:"0.5rem"},children:C.reasons.map((y,j)=>e.jsx("button",{type:"button",onClick:()=>W(y),style:{padding:"0.5rem 1rem",borderRadius:"2rem",border:"1px solid var(--color-primary)",background:g.includes(y)?"var(--color-primary)":"white",color:g.includes(y)?"white":"var(--color-primary)",cursor:"pointer"},children:y},j))})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{children:"Time Spent (Minutes)"}),e.jsx(Ne,{value:T,onChange:O})]}),e.jsx(Se,{value:B,onChange:b}),e.jsx("button",{type:"submit",className:"btn-primary",style:{width:"100%",opacity:T?1:.5,cursor:T?"pointer":"not-allowed"},disabled:!T,children:"Save Log"})]}):e.jsxs("div",{style:{display:"grid",gap:"1.5rem"},children:[e.jsx("p",{style:{textAlign:"center",color:"var(--color-text-secondary)"},children:"What's pulling your attention?"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:"1rem"},children:[r.map(y=>e.jsxs("button",{onClick:()=>D(y),style:{textAlign:"left",cursor:"pointer",border:"1px solid var(--color-bg-secondary)",background:"white",padding:"1.25rem",borderRadius:"var(--radius-lg)",boxShadow:"0 2px 4px rgba(0,0,0,0.05)",transition:"transform 0.1s, border-color 0.1s",display:"flex",alignItems:"center",justifyContent:"space-between"},onMouseEnter:j=>{j.currentTarget.style.borderColor="var(--color-primary)",j.currentTarget.style.transform="translateY(-2px)"},onMouseLeave:j=>{j.currentTarget.style.borderColor="var(--color-bg-secondary)",j.currentTarget.style.transform="translateY(0)"},children:[e.jsx("div",{style:{fontWeight:"600",fontSize:"1.1rem",color:"var(--color-text-primary)"},children:y.name}),e.jsx(Y,{size:16,style:{transform:"rotate(180deg)",color:"var(--color-text-secondary)"}})]},y.id)),e.jsxs("button",{onClick:()=>s("config"),style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",cursor:"pointer",border:"2px dashed var(--color-bg-secondary)",background:"transparent",padding:"1rem",borderRadius:"var(--radius-lg)",color:"var(--color-text-secondary)",fontWeight:"500"},children:[e.jsx(fe,{size:20}),e.jsx("span",{children:"Add New"})]})]})]})]})}):e.jsx(P,{children:e.jsxs("div",{className:"container",style:{textAlign:"center",paddingTop:"2rem"},children:[e.jsx("div",{style:{position:"absolute",left:"1rem",top:"5rem"},children:e.jsxs("button",{onClick:()=>i("/"),style:{background:"var(--color-bg-secondary)",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",color:"var(--color-primary)",padding:"0.5rem 1rem",borderRadius:"2rem",fontWeight:"500"},children:[e.jsx(Y,{size:18})," Back"]})}),e.jsx(we,{size:64,style:{color:"var(--color-text-accent)",marginBottom:"1rem"}}),e.jsx("h2",{style:{fontSize:"2rem",marginBottom:"2rem"},children:"Distracted?"}),e.jsxs("div",{style:{display:"grid",gap:"1rem",width:"100%",maxWidth:"320px",margin:"0 auto"},children:[e.jsxs("button",{className:"btn-primary",style:{padding:"1.25rem",fontSize:"1.1rem",background:"#fee2e2",color:"#b91c1c",border:"1px solid #fecaca",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.75rem",borderRadius:"var(--radius-lg)"},onClick:()=>{A(),s("logging")},children:[e.jsx(we,{size:24})," Yes, I gave in"]}),e.jsxs("button",{className:"btn-primary",style:{padding:"1.25rem",fontSize:"1.1rem",background:"#dcfce7",color:"#15803d",border:"1px solid #bbf7d0",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.75rem",borderRadius:"var(--radius-lg)"},onClick:()=>s("calm"),children:[e.jsx(ye,{size:24})," No, I'm focused"]})]}),e.jsx("div",{style:{marginTop:"2rem"},children:e.jsxs("button",{onClick:()=>s("config"),style:{display:"inline-flex",alignItems:"center",gap:"0.5rem",background:"transparent",border:"1px dashed var(--color-text-secondary)",color:"var(--color-text-secondary)",cursor:"pointer",padding:"0.75rem 1.5rem",borderRadius:"var(--radius-full)",fontSize:"0.9rem",transition:"all 0.2s"},children:[e.jsx(fe,{size:16})," Add Distraction"]})})]})})},ct=(i,t="")=>Object.keys(i).reduce((s,r)=>{const a=t.length?t+".":"";return typeof i[r]=="object"&&i[r]!==null&&!Array.isArray(i[r])?Object.assign(s,ct(i[r],a+r)):Array.isArray(i[r])?s[a+r]=i[r].join(";"):s[a+r]=i[r],s},{}),dt=i=>{if(!i||i.length===0)return"";const t=i.map(a=>ct(a)),s=Array.from(new Set(t.flatMap(Object.keys)));return s.sort((a,u)=>a==="timestamp"?-1:u==="timestamp"?1:a==="event_type"?-1:u==="event_type"?1:a.localeCompare(u)),[s.join(","),...t.map(a=>s.map(u=>{let n=a[u]||"";const l=String(n);return l.includes(",")||l.includes('"')||l.includes(`
`)?`"${l.replace(/"/g,'""')}"`:l}).join(","))].join(`
`)},mt=(i,t="stop-procrastinating-data.csv")=>{const s=new Blob([i],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a");if(r.download!==void 0){const a=URL.createObjectURL(s);r.setAttribute("href",a),r.setAttribute("download",t),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)}},hr=()=>{const i=q(),[t,s]=m.useState([]),[r,a]=m.useState([]);m.useEffect(()=>{const n=x(d.TASKS,[]),l=x(d.SCHEDULED_TASKS,[]),c=x(d.WORK_LOGS,[]),h=x(d.DISTRACTION_LOGS,[]),S=x(d.REFLECTIONS,[]),f={},p=g=>(f[g]||(f[g]={date:new Date(g).toISOString(),taskTime:0,distractionTime:0,pointsScored:0,workScore:0,procrastinationScore:0,tasksDoneCount:0}),f[g]);[...n,...l].forEach(g=>{if(g.completed&&g.completedAt){const v=new Date(g.completedAt).toDateString(),T=p(v);T.taskTime+=parseInt(g.timeTaken)||0,T.tasksDoneCount+=1,g.pointsEarned!==void 0?T.pointsScored+=g.pointsEarned:T.pointsScored+=10+(parseInt(g.timeTaken)||0)}}),c.forEach(g=>{if(g.date){const v=new Date(g.date).toDateString(),T=p(v),O=parseInt(g.duration)||0;T.taskTime+=O,T.pointsScored+=O,T.tasksDoneCount+=1}}),h.forEach(g=>{if(g.date){const v=new Date(g.date).toDateString(),T=p(v);T.distractionTime+=parseInt(g.duration)||0}}),S.forEach(g=>{const v=new Date(g.date).toDateString();f[v]||(f[v]={...g,date:new Date(v).toISOString()})}),Object.keys(f).forEach(g=>{const v=f[g],T=v.taskTime+v.distractionTime;T>0&&(v.procrastinationScore=Math.round(v.distractionTime/T*100),v.workScore=100-v.procrastinationScore)});const C=Object.values(f).sort((g,v)=>new Date(g.date)-new Date(v.date));s(C);const D=lt();a(D)},[]);const u=()=>{const n=x(d.EVENT_LOG,[]);if(!n||n.length===0){alert("No detailed event data found yet. Start using the app to generate logs!");return}const l=dt(n);mt(l,`stop_procrastinating_events_${new Date().toISOString().split("T")[0]}.csv`)};return e.jsx(P,{children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"2rem"},children:[e.jsxs("button",{onClick:()=>i("/"),style:{background:"var(--color-bg-secondary)",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",color:"var(--color-primary)",padding:"0.5rem 1rem",borderRadius:"2rem",fontWeight:"500",marginRight:"1rem"},children:[e.jsx(Y,{size:18})," Back"]}),e.jsx("h2",{style:{flex:1,textAlign:"center",margin:0},children:"Progress Analysis"}),e.jsx("button",{onClick:u,style:{background:"transparent",border:"1px solid var(--color-primary)",color:"var(--color-primary)",padding:"0.5rem",borderRadius:"50%",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Export Detailed Event Logs (CSV)",children:e.jsx(je,{size:20})})]}),e.jsxs("div",{style:{display:"grid",gap:"2rem"},children:[r.length>0&&e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"1rem"},children:r.map((n,l)=>e.jsxs("div",{className:"card",style:{background:n.type==="warning"?"#fef2f2":n.type==="success"?"#f0fdf4":"#f0f9ff",border:n.type==="warning"?"1px solid #fecaca":n.type==="success"?"1px solid #bbf7d0":"1px solid #bae6fd"},children:[e.jsxs("h3",{style:{marginBottom:"0.5rem",fontSize:"1rem",color:n.type==="warning"?"#b91c1c":n.type==="success"?"#15803d":"#0369a1",display:"flex",alignItems:"center",gap:"0.5rem"},children:[n.type==="warning"?e.jsx(ze,{size:18}):n.type==="success"?e.jsx(He,{size:18}):e.jsx(pe,{size:18}),n.title]}),e.jsx("p",{style:{color:n.type==="warning"?"#991b1b":n.type==="success"?"#166534":"#0284c7",fontSize:"0.95rem",margin:0},children:n.text.replace(/\*\*/g,"")})]},l))}),e.jsxs("div",{className:"card",style:{height:"400px",display:"flex",flexDirection:"column"},children:[e.jsx("h3",{style:{marginBottom:"1rem",color:"var(--color-text-primary)"},children:"Focus Consistency"}),e.jsx("p",{style:{fontSize:"0.9rem",color:"var(--color-text-secondary)",marginBottom:"1rem"},children:"Work Score vs Procrastination Score over time."}),e.jsx("div",{style:{flex:1,minHeight:0},children:e.jsx(me,{width:"100%",height:"100%",children:e.jsxs(It,{data:t,margin:{top:5,right:5,bottom:5,left:-20},children:[e.jsx(be,{strokeDasharray:"3 3",vertical:!1,stroke:"#e2e8f0"}),e.jsx(De,{dataKey:"date",tickFormatter:n=>new Date(n).getDate()+"/"+(new Date(n).getMonth()+1),tick:{fontSize:12},stroke:"#94a3b8"}),e.jsx(Te,{tick:{fontSize:12},stroke:"#94a3b8"}),e.jsx(ue,{labelFormatter:n=>new Date(n).toDateString(),contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"}}),e.jsx(Oe,{}),e.jsx(Be,{type:"monotone",dataKey:"workScore",name:"Work Score",stroke:"#22c55e",strokeWidth:3,dot:{r:4},activeDot:{r:6}}),e.jsx(Be,{type:"monotone",dataKey:"procrastinationScore",name:"Procrastination",stroke:"#ef4444",strokeWidth:3,dot:{r:4}})]})})})]}),e.jsxs("div",{className:"card",style:{height:"400px",display:"flex",flexDirection:"column"},children:[e.jsx("h3",{style:{marginBottom:"1rem",color:"var(--color-text-primary)"},children:"Daily Time Breakdown (Mins)"}),e.jsx("div",{style:{flex:1,minHeight:0},children:e.jsx(me,{width:"100%",height:"100%",children:e.jsxs(At,{data:t,margin:{top:5,right:5,bottom:5,left:-20},children:[e.jsx(be,{strokeDasharray:"3 3",vertical:!1,stroke:"#e2e8f0"}),e.jsx(De,{dataKey:"date",tickFormatter:n=>new Date(n).getDate()+"/"+(new Date(n).getMonth()+1),tick:{fontSize:12},stroke:"#94a3b8"}),e.jsx(Te,{tick:{fontSize:12},stroke:"#94a3b8"}),e.jsx(ue,{labelFormatter:n=>new Date(n).toDateString(),cursor:{fill:"#f1f5f9"},contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"}}),e.jsx(Oe,{}),e.jsx(We,{dataKey:"taskTime",name:"Productive Time",stackId:"a",fill:"#22c55e",radius:[0,0,4,4]}),e.jsx(We,{dataKey:"distractionTime",name:"Distracted Time",stackId:"a",fill:"#f97316",radius:[4,4,0,0]})]})})})]}),e.jsxs("div",{className:"card",style:{height:"350px",display:"flex",flexDirection:"column"},children:[e.jsx("h3",{style:{marginBottom:"1rem",color:"var(--color-text-primary)"},children:"Growth (Points Earned)"}),e.jsx("div",{style:{flex:1,minHeight:0},children:e.jsx(me,{width:"100%",height:"100%",children:e.jsxs(Et,{data:t,margin:{top:5,right:5,bottom:5,left:-20},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorPoints",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#8b5cf6",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#8b5cf6",stopOpacity:0})]})}),e.jsx(be,{strokeDasharray:"3 3",vertical:!1,stroke:"#e2e8f0"}),e.jsx(De,{dataKey:"date",tickFormatter:n=>new Date(n).getDate()+"/"+(new Date(n).getMonth()+1),tick:{fontSize:12},stroke:"#94a3b8"}),e.jsx(Te,{tick:{fontSize:12},stroke:"#94a3b8"}),e.jsx(ue,{labelFormatter:n=>new Date(n).toDateString(),contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"}}),e.jsx(zt,{type:"monotone",dataKey:"pointsScored",name:"Points",stroke:"#8b5cf6",fillOpacity:1,fill:"url(#colorPoints)"})]})})})]})]})]})})},xr=()=>{const i=q(),[t,s]=m.useState(!1),[r,a]=m.useState(null),u=async()=>{s(!0),a(null);try{const l=(await $t(G,Qt)).user,c=he(oe,"users",l.uid);if((await et(c)).exists())nt(),await tt(l);else{const S={email:l.email,displayName:l.displayName,createdAt:new Date().toISOString(),tasks:JSON.stringify(x(d.TASKS,[])),scheduled:JSON.stringify(x(d.SCHEDULED_TASKS,[])),reflections:JSON.stringify(x(d.REFLECTIONS,[])),stats:JSON.stringify(x(d.USER_STATS,{})),mood:x(d.USER_MOOD,null)};await Re(c,S),console.log("Local data backed up to cloud!")}i("/")}catch(n){console.error("Login Result Error:",n),a(`Failed to sign in: ${n.message}`)}finally{s(!1)}};return e.jsx(P,{children:e.jsx("div",{className:"container",style:{textAlign:"center",marginTop:"4rem"},children:e.jsxs("div",{className:"card",style:{maxWidth:"400px",margin:"0 auto"},children:[e.jsx("h2",{style:{marginBottom:"1rem"},children:"Backup Your Progress"}),e.jsx("p",{style:{color:"var(--color-text-secondary)",marginBottom:"2rem"},children:"Sign in to save your tasks, streaks, and reflections to the cloud. Access them from any device."}),r&&e.jsx("div",{style:{color:"var(--color-danger)",marginBottom:"1rem",fontSize:"0.9rem"},children:r}),e.jsxs("button",{onClick:u,disabled:t,className:"btn-primary",style:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center",gap:"0.75rem",padding:"0.75rem"},children:[t?e.jsx(Rt,{className:"spin",size:20}):e.jsx(Me,{size:20}),t?"Signing In...":"Sign in with Google"]})]})})})},fr=()=>{const[i,t]=m.useState("idle");return m.useEffect(()=>{let s;const r=()=>{t("syncing"),clearTimeout(s)},a=()=>{t("success"),s=setTimeout(()=>{t("idle")},3e3)},u=()=>{t("error")};return window.addEventListener("sp-sync-start",r),window.addEventListener("sp-sync-success",a),window.addEventListener("sp-sync-error",u),()=>{window.removeEventListener("sp-sync-start",r),window.removeEventListener("sp-sync-success",a),window.removeEventListener("sp-sync-error",u),clearTimeout(s)}},[]),e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:"0.5rem",padding:"0.25rem 0.75rem",borderRadius:"2rem",fontSize:"0.85rem",fontWeight:"500",transition:"all 0.3s ease",...jr(i)},children:[vr(i),e.jsx("span",{children:Sr(i)})]})},jr=i=>{switch(i){case"syncing":return{background:"#ebf8ff",color:"#0369a1"};case"success":return{background:"#f0fdf4",color:"#166534"};case"error":return{background:"#fef2f2",color:"#991b1b"};default:return{}}},vr=i=>{switch(i){case"syncing":return e.jsx(Qe,{size:14,className:"spin"});case"success":return e.jsx(Nt,{size:14});case"error":return e.jsx(Z,{size:14});default:return e.jsx(Lt,{size:14})}},Sr=i=>{switch(i){case"syncing":return"Syncing...";case"success":return"Saved";case"error":return"Sync Failed";default:return"Sync Ready"}},br=()=>{const i=q(),{theme:t,toggleTheme:s}=it(),r=G.currentUser,[a,u]=m.useState(0),n=()=>{const S=x(d.EVENT_LOG,[]);if(!S||S.length===0){alert("No data to export yet.");return}const f=dt(S);mt(f,`stop_procrastinating_backup_${new Date().toISOString().split("T")[0]}.csv`)},l=()=>{window.confirm("ARE YOU SURE? This will delete ALL your logs, streaks, and local data. This action cannot be undone.")&&(nt(),window.location.reload())},c=()=>{Yt(G).then(()=>{i("/"),window.location.reload()})},h=async()=>{await er()};return e.jsx(P,{children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"2rem"},children:[e.jsxs("button",{onClick:()=>i(-1),className:"btn-secondary",style:{display:"flex",alignItems:"center",gap:"0.5rem",marginRight:"1rem"},children:[e.jsx(Y,{size:18})," Back"]}),e.jsx("h2",{style:{margin:0},children:"Settings"}),e.jsx("div",{style:{marginLeft:"auto"},children:e.jsx(fr,{})})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[e.jsxs("div",{className:"card",children:[e.jsxs("h3",{style:{marginTop:0,marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[t==="light"?e.jsx(Ae,{size:20}):e.jsx(Ie,{size:20})," Appearance"]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"App Theme"}),e.jsx("button",{onClick:s,className:"btn-secondary",style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:t==="light"?"Switch to Dark Mode":"Switch to Light Mode"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h3",{style:{marginTop:0,marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(je,{size:20})," Data Management"]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsxs("button",{onClick:h,className:"btn-secondary",style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",width:"100%"},children:[e.jsx(Qe,{size:18})," Sync Now"]}),e.jsxs("button",{onClick:n,className:"btn-secondary",style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",width:"100%"},children:[e.jsx(je,{size:18})," Export Data (CSV)"]}),e.jsx("div",{style:{borderTop:"1px solid var(--border-color)",margin:"0.5rem 0"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("strong",{style:{color:"var(--color-danger)"},children:"Danger Zone"}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--color-text-secondary)",margin:0},children:"Irreversible data loss."})]}),e.jsxs("button",{onClick:l,style:{background:"#fee2e2",color:"#b91c1c",border:"1px solid #fca5a5",padding:"0.5rem 1rem",borderRadius:"var(--radius-md)",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.9rem",fontWeight:"500"},children:[e.jsx(ge,{size:16})," Clear All Data"]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h3",{style:{marginTop:0,marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(Ke,{size:20})," Account"]}),r?e.jsxs("div",{style:{textAlign:"center"},children:[r.photoURL&&e.jsx("img",{src:r.photoURL,alt:"Profile",style:{width:"64px",height:"64px",borderRadius:"50%",marginBottom:"0.5rem"}}),e.jsx("div",{style:{fontWeight:"bold",fontSize:"1.1rem"},children:r.displayName||"User"}),e.jsx("div",{style:{color:"var(--color-text-secondary)",marginBottom:"1.5rem"},children:r.email}),e.jsxs("button",{onClick:c,className:"btn-secondary",style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[e.jsx(_t,{size:18})," Sign Out"]})]}):e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("p",{children:"You are using a local guest account."}),e.jsx("button",{onClick:()=>i("/signin"),className:"btn-primary",style:{width:"100%"},children:"Sign In with Google"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h3",{style:{marginTop:0,marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(Pe,{size:20})," Feedback"]}),e.jsx("p",{style:{color:"var(--color-text-secondary)",fontSize:"0.9rem",marginBottom:"1rem"},children:"Help us improve! Share your experience, report bugs, or suggest new features."}),e.jsxs("a",{href:"https://forms.gle/fh9NiUWpYispsEka6",target:"_blank",rel:"noopener noreferrer",className:"btn-primary",style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",textDecoration:"none",width:"100%"},children:[e.jsx(Pe,{size:18})," Send Feedback / Suggestions"]})]}),e.jsxs("div",{style:{textAlign:"center",color:"var(--color-text-secondary)",fontSize:"0.9rem",marginTop:"1rem",cursor:"default"},onClick:()=>u(S=>S+1),children:[e.jsx("p",{children:"Stop Procrastinating v1.0.2"}),e.jsx("p",{children:"Build healthy habits, one day at a time."}),a>5&&e.jsx("p",{children:"ü¶Ñ You found a unicorn!"})]})]})]})})};function Dr(){return m.useEffect(()=>{const i=G.onAuthStateChanged(t=>{t&&tt(t)});return()=>i()},[]),e.jsx(Ot,{children:e.jsxs(Bt,{children:[e.jsx(H,{path:"/",element:e.jsx(ir,{})}),e.jsx(H,{path:"/analysis",element:e.jsx(hr,{})}),e.jsx(H,{path:"/settings",element:e.jsx(br,{})}),e.jsx(H,{path:"/signin",element:e.jsx(xr,{})}),e.jsx(H,{path:"/mood",element:e.jsx(cr,{})}),e.jsx(H,{path:"/tasks",element:e.jsx(dr,{})}),e.jsx(H,{path:"/add-task",element:e.jsx(mr,{})}),e.jsx(H,{path:"/complete/:taskId",element:e.jsx(ur,{})}),e.jsx(H,{path:"/schedule",element:e.jsx(pr,{})}),e.jsx(H,{path:"/reflect",element:e.jsx(gr,{})}),e.jsx(H,{path:"/limit",element:e.jsx(yr,{})})]})})}Wt.createRoot(document.getElementById("root")).render(e.jsx(m.StrictMode,{children:e.jsx(tr,{children:e.jsx(Dr,{})})}));
