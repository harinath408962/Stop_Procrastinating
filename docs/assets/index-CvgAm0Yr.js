import{r as d,j as e,u as mt,L as ce,S as pt,M as Ce,a as Ie,U as We,b as Pe,H as ut,C as Ae,c as we,d as gt,T as Fe,e as G,D as fe,f as yt,Z as pe,g as Ee,A as xt,h as Ue,R as de,P as Ke,i as Me,k as je,l as me,B as ht,m as ft,n as Y,p as X,q as he,s as He,t as ue,v as jt,w as vt,x as St,y as ge,z as Ge,E as qe,F as bt,G as $e,I as Dt,X as Ye,J as Tt,K as wt,N as be,O as De,Y as Te,Q as Ne,V as Le,W as kt,_ as Oe,$ as Ct,a0 as It,a1 as At,a2 as Et,a3 as zt,a4 as Je,a5 as Rt,a6 as Be,a7 as Nt,a8 as Lt,a9 as H,aa as Ot}from"./vendor-BxH-JlEu.js";import{i as Bt,g as _t,G as Wt,a as Pt,d as Se,b as Ve,s as Xe,o as Ft,w as Ut,c as Kt,e as Mt,f as Ht}from"./firebase-DHWCcEE5.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const p of a)if(p.type==="childList")for(const o of p.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function s(a){const p={};return a.integrity&&(p.integrity=a.integrity),a.referrerPolicy&&(p.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?p.credentials="include":a.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function r(a){if(a.ep)return;a.ep=!0;const p=s(a);fetch(a.href,p)}})();const Gt={apiKey:"AIzaSyCO5r-8hPDpEJD2qY2llWyf_gAQXVlu4CU",authDomain:"stop-procrastinating-9ffaf.firebaseapp.com",projectId:"stop-procrastinating-9ffaf",storageBucket:"stop-procrastinating-9ffaf.firebasestorage.app",messagingSenderId:"270312713724",appId:"1:270312713724:web:98e212793206ff87511679",measurementId:"G-KYLVPZXV20"},Ze=Bt(Gt),q=_t(Ze),qt=new Wt,ye=Pt(Ze),m={USER_MOOD:"sp_user_mood",TASKS:"sp_tasks",SCHEDULED_TASKS:"sp_scheduled_tasks",DISTRACTION_LOGS:"sp_distraction_logs",WORK_LOGS:"sp_work_logs",REFLECTIONS:"sp_daily_reflections",USER_STATS:"sp_user_stats",EVENT_LOG:"sp_event_log"},Qe=async i=>{if(i)try{const t=Se(ye,"users",i.uid),s=await Ve(t);if(s.exists()){const r=s.data(),a=p=>{try{return typeof p=="string"?JSON.parse(p):p}catch{return p}};r.tasks&&N(m.TASKS,a(r.tasks),!0),r.scheduled&&N(m.SCHEDULED_TASKS,a(r.scheduled),!0),r.reflections&&N(m.REFLECTIONS,a(r.reflections),!0),r.stats&&N(m.USER_STATS,a(r.stats),!0),r.mood&&N(m.USER_MOOD,r.mood,!0),r.distractions&&N(m.DISTRACTION_LOGS,a(r.distractions),!0),r.work_logs&&N(m.WORK_LOGS,a(r.work_logs),!0),console.log("Full sync from cloud completed."),window.dispatchEvent(new CustomEvent("sp-data-loaded"))}}catch(t){console.error("Error loading from cloud:",t)}},et=async(i,t,s=!1)=>{const r=q.currentUser;if(r)try{const a=Se(ye,"users",r.uid);s||window.dispatchEvent(new CustomEvent("sp-sync-start"));const o={[m.TASKS]:"tasks",[m.SCHEDULED_TASKS]:"scheduled",[m.REFLECTIONS]:"reflections",[m.USER_STATS]:"stats",[m.USER_MOOD]:"mood",[m.DISTRACTION_LOGS]:"distractions",[m.WORK_LOGS]:"work_logs"}[i];if(o){const l=typeof t=="object"?JSON.stringify(t):t;await Xe(a,{[o]:l},{merge:!0}),console.log(`Synced ${i} to cloud.`),s||window.dispatchEvent(new CustomEvent("sp-sync-success"))}}catch(a){console.error("Cloud sync failed:",a),s||window.dispatchEvent(new CustomEvent("sp-sync-error",{detail:a}))}},y=(i,t=null)=>{try{const s=localStorage.getItem(i);return s?JSON.parse(s):t}catch(s){return console.error(`Error reading ${i} from storage:`,s),t}},N=(i,t,s=!1)=>{try{localStorage.setItem(i,JSON.stringify(t)),s||et(i,t)}catch(r){console.error(`Error writing ${i} to storage:`,r)}},tt=()=>{const i=new Date().toDateString();let t=y(m.USER_STATS,{totalPoints:0,currentStreak:0,longestStreak:0,lastActiveDate:null});if(t.lastActiveDate!==i){const s=new Date;s.setDate(s.getDate()-1),t.lastActiveDate===s.toDateString()?t.currentStreak+=1:t.lastActiveDate===null?t.currentStreak=1:t.currentStreak+=1,t.currentStreak>t.longestStreak&&(t.longestStreak=t.currentStreak),t.lastActiveDate=i,N(m.USER_STATS,t)}return t},ke=i=>{let t=y(m.USER_STATS,{totalPoints:0,currentStreak:0,longestStreak:0,lastActiveDate:null});return t.totalPoints+=i,N(m.USER_STATS,t),t},rt=()=>{Object.values(m).forEach(i=>{localStorage.removeItem(i)}),localStorage.removeItem("sp_user_name")},$t=async()=>{if(q.currentUser){window.dispatchEvent(new CustomEvent("sp-sync-start"));try{const t=Object.values(m).map(async s=>{const r=y(s);r!==null&&await et(s,r,!0)});return await Promise.all(t),window.dispatchEvent(new CustomEvent("sp-sync-success")),!0}catch(t){return console.error("Force sync failed:",t),window.dispatchEvent(new CustomEvent("sp-sync-error",{detail:t})),!1}}},st=d.createContext(),nt=()=>d.useContext(st),Yt=({children:i})=>{const[t,s]=d.useState(()=>{try{return localStorage.getItem("sp_theme")||"light"}catch{return"light"}});d.useEffect(()=>{const a=document.documentElement;t==="dark"?a.setAttribute("data-theme","dark"):a.removeAttribute("data-theme"),localStorage.setItem("sp_theme",t)},[t]);const r=()=>{s(a=>a==="light"?"dark":"light")};return e.jsx(st.Provider,{value:{theme:t,toggleTheme:r},children:i})},Jt=async()=>"Notification"in window?Notification.permission==="granted"?!0:Notification.permission!=="denied"?await Notification.requestPermission()==="granted":!1:(console.log("This browser does not support desktop notification"),!1),Vt=(i,t,s)=>{if(Notification.permission==="granted")try{navigator.serviceWorker&&navigator.serviceWorker.controller?navigator.serviceWorker.ready.then(r=>{r.showNotification(i,{body:t,icon:"/vite.svg",tag:s,vibrate:[200,100,200]})}):new Notification(i,{body:t,icon:"/vite.svg",tag:s})}catch(r){console.error("Notification failed:",r)}},_e=i=>{const t=new Date,s=t.toLocaleDateString("en-US",{weekday:"short"}),r=t.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit"}),a="sp_last_notification_check";if(localStorage.getItem(a)===r)return[];localStorage.setItem(a,r);const o=[];return i.forEach(l=>{if(!l.completed&&l.reminderTime&&l.reminderTime===r){let c=!1;if(l.frequency==="daily")c=!0;else if(l.frequency==="custom"&&l.repeatDays&&Array.isArray(l.repeatDays))l.repeatDays.includes(s)&&(c=!0);else if(l.frequency==="once"){const x=new Date().setHours(0,0,0,0);if(l.startDate&&l.dueDate){const w=new Date(l.startDate).setHours(0,0,0,0),j=new Date(l.dueDate).setHours(0,0,0,0);x>=w&&x<=j&&(c=!0)}else c=!0}c&&(Vt("Time to focus! üéØ",`Reminder: ${l.title||l.name}`,l.id),o.push(l.id))}}),o},W=({children:i})=>{const t=mt(),s=y(m.USER_STATS,{totalPoints:0,currentStreak:0}),[r,a]=d.useState(null),{theme:p,toggleTheme:o}=nt();return d.useEffect(()=>{const l=Ft(q,c=>{a(c)});return()=>l()},[]),d.useEffect(()=>{Jt();const l=setInterval(()=>{const w=y(m.TASKS,[]),j=y(m.SCHEDULED_TASKS,[]),D=[...w,...j];_e(D)},6e4),c=y(m.TASKS,[]),x=y(m.SCHEDULED_TASKS,[]);return _e([...c,...x]),()=>clearInterval(l)},[]),e.jsxs("div",{className:"layout-wrapper",style:{minHeight:"100vh",display:"flex",flexDirection:"column"},children:[e.jsxs("header",{style:{padding:"1rem",borderBottom:"1px solid #e2e8f0",display:"flex",justifyContent:"space-between",alignItems:"center",background:"var(--header-bg)",color:"var(--color-text-primary)"},children:[e.jsx(ce,{to:"/",style:{textDecoration:"none",color:"var(--color-primary)",fontWeight:"bold"},children:"Stop Procrastinating"}),e.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"center",fontSize:"0.875rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx("span",{role:"img","aria-label":"streak",children:"üî•"}),e.jsxs("span",{children:[s.currentStreak," Days"]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx("span",{role:"img","aria-label":"points",children:"‚ú®"}),e.jsxs("span",{children:[s.totalPoints," pts"]})]}),e.jsx(ce,{to:"/settings",style:{color:"var(--color-primary)",display:"flex",alignItems:"center"},children:e.jsx(pt,{size:20})}),e.jsx("button",{onClick:o,style:{background:"none",border:"none",cursor:"pointer",color:"var(--color-primary)",display:"flex",alignItems:"center",padding:"0.25rem"},"aria-label":"Toggle Theme",children:p==="light"?e.jsx(Ce,{size:20}):e.jsx(Ie,{size:20})}),r?e.jsx(ce,{to:"/settings",style:{display:"flex",alignItems:"center",gap:"0.5rem",marginLeft:"0.5rem",textDecoration:"none",color:"inherit"},children:r.photoURL?e.jsx("img",{src:r.photoURL,alt:"User",style:{width:"28px",height:"28px",borderRadius:"50%",objectFit:"cover"}}):e.jsx("div",{style:{width:"24px",height:"24px",borderRadius:"50%",background:"rgba(99, 102, 241, 0.1)",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--color-primary)"},children:e.jsx(We,{size:16})})}):e.jsxs(ce,{to:"/signin",style:{display:"flex",alignItems:"center",gap:"0.25rem",textDecoration:"none",color:"var(--color-primary)",marginLeft:"0.5rem"},children:[e.jsx(Pe,{size:18}),e.jsx("span",{children:"Sign In"})]})]})]}),e.jsx("main",{style:{flex:1,paddingBottom:"2rem"},children:i}),e.jsxs("nav",{style:{position:"fixed",bottom:0,left:0,width:"100%",background:"var(--nav-bg)",borderTop:"1px solid var(--border-color)",display:"flex",justifyContent:"space-around",padding:"0.75rem 0",zIndex:100},children:[e.jsx(le,{to:"/",icon:e.jsx(ut,{size:20}),label:"Home",active:t.pathname==="/"||t.pathname==="/mood"}),e.jsx(le,{to:"/schedule",icon:e.jsx(Ae,{size:20}),label:"Tasks",active:t.pathname==="/schedule"}),e.jsx(le,{to:"/limit",icon:e.jsx(we,{size:20}),label:"Limit",active:t.pathname==="/limit"}),e.jsx(le,{to:"/reflect",icon:e.jsx(gt,{size:20}),label:"Reflect",active:t.pathname==="/reflect"}),e.jsx(le,{to:"/analysis",icon:e.jsx(Fe,{size:20}),label:"Analysis",active:t.pathname==="/analysis"})]}),e.jsx("div",{style:{height:"70px"}})]})},le=({to:i,icon:t,label:s,active:r})=>e.jsxs(ce,{to:i,style:{display:"flex",flexDirection:"column",alignItems:"center",textDecoration:"none",color:r?"var(--color-primary)":"var(--color-text-secondary)",fontSize:"0.75rem"},children:[t,e.jsx("span",{style:{marginTop:"0.25rem"},children:s})]}),Xt=(i,t)=>{const s={morning:{attempts:0,completed:0,totalMinutes:0,score:0},afternoon:{attempts:0,completed:0,totalMinutes:0,score:0},evening:{attempts:0,completed:0,totalMinutes:0,score:0},night:{attempts:0,completed:0,totalMinutes:0,score:0}},r=l=>{const c=new Date(l).getHours();return c>=5&&c<12?"morning":c>=12&&c<17?"afternoon":c>=17&&c<21?"evening":"night"},a=new Date;a.setDate(a.getDate()-30);const p=a.setHours(0,0,0,0),o=l=>l?new Date(l).getTime()>=p:!1;return i.forEach(l=>{if(!l.completedAt||!o(l.completedAt))return;const c=r(l.completedAt);s[c].attempts++,s[c].completed++,s[c].totalMinutes+=parseInt(l.timeTaken)||0}),t.forEach(l=>{if(!o(l.date))return;const c=r(l.date);s[c].attempts++,s[c].completed++,s[c].totalMinutes+=parseInt(l.duration)||0}),Object.keys(s).forEach(l=>{const c=s[l];c.score=c.totalMinutes+c.completed*10}),s},Zt=i=>{const t={},s={morning:0,afternoon:0,evening:0,night:0},r=new Date;r.setDate(r.getDate()-30);const a=r.setHours(0,0,0,0);return i.forEach(o=>{if(!o.date||new Date(o.date).getTime()<a)return;t[o.app]=(t[o.app]||0)+1;const l=new Date(o.date).getHours();let c="night";l>=5&&l<12?c="morning":l>=12&&l<17?c="afternoon":l>=17&&l<21&&(c="evening"),s[c]++}),{sortedTriggers:Object.entries(t).sort(([,o],[,l])=>l-o).map(([o,l])=>({app:o,count:l})),timePatterns:s}},ot=()=>{const i=y(m.TASKS,[]),t=y(m.SCHEDULED_TASKS,[]),s=y(m.WORK_LOGS,[]),r=y(m.DISTRACTION_LOGS,[]),a=[...i,...t],p=Xt(a,s),{sortedTriggers:o,timePatterns:l}=Zt(r),c=[];let x="morning",w=-1;if(Object.entries(p).forEach(([j,D])=>{D.score>w&&(w=D.score,x=j)}),w>50&&c.push({type:"success",title:"‚ú® Peak Performance",text:`You are naturally most productive in the **${x}**. Schedule your hardest tasks then!`}),o.length>0){const j=o[0];let D="night",L=-1;Object.entries(l).forEach(([A,u])=>{u>L&&(L=u,D=A)}),L>2&&c.push({type:"warning",title:"‚ö†Ô∏è Distraction Alert",text:`Watch out for **${j.app}** in the ${D}. It's your top distraction.`})}return c.length<2&&c.push({type:"info",title:"üí° Tip",text:"Log more work and distractions to unlock deeper insights into your habits."}),c},Qt=()=>{const i=G(),[t,s]=d.useState("Friend"),[r,a]=d.useState(0),[p,o]=d.useState(0),[l,c]=d.useState("Start your day!"),[x,w]=d.useState(null),[j,D]=d.useState([]),[L,A]=d.useState([]),[u,v]=d.useState(null),[S,F]=d.useState(null);d.useEffect(()=>{const f=z=>{z.preventDefault(),F(z)};return window.addEventListener("beforeinstallprompt",f),()=>window.removeEventListener("beforeinstallprompt",f)},[]);const B=async()=>{if(!S)return;S.prompt();const{outcome:f}=await S.userChoice;f==="accepted"&&F(null)};return d.useEffect(()=>{s(y(m.USER_NAME,"Friend"));const f=y(m.USER_STATS,{currentStreak:0,totalPoints:0});a(f.currentStreak),o(f.totalPoints);const z=()=>{new Date().setHours(0,0,0,0);const k=y(m.DISTRACTION_LOGS,[]).filter(T=>new Date(T.date).toDateString()===new Date().toDateString()),O=k.reduce((T,P)=>T+parseInt(P.duration||0),0),_=k.length,C={};k.forEach(T=>{C[T.app]=(C[T.app]||0)+parseInt(T.duration||0)});const g=Object.entries(C).sort(([,T],[,P])=>P-T).slice(0,3).map(([T,P])=>({name:T,duration:P}));A(g);const h=y(m.TASKS,[]),U=y(m.SCHEDULED_TASKS,[]),Z=h.filter(T=>T.completed&&T.completedAt&&new Date(T.completedAt).toDateString()===new Date().toDateString()),$=U.filter(T=>T.completed&&T.completedAt&&new Date(T.completedAt).toDateString()===new Date().toDateString()),te=[...Z,...$],J=te.reduce((T,P)=>T+(parseInt(P.timeTaken)||0),0),re=y(m.WORK_LOGS,[]).filter(T=>new Date(T.date).toDateString()===new Date().toDateString()),se=re.reduce((T,P)=>T+parseInt(P.duration||0),0),ne=J+se,ie=te.length,ae=te.reduce((T,P)=>{if(P.pointsEarned!==void 0)return T+P.pointsEarned;const dt=parseInt(P.timeTaken)||0;return T+10+dt},0),Q=re.reduce((T,P)=>T+parseInt(P.duration||0),0),E=ae+Q;let n=0,b=0;const I=ne+O;let K="Ready to start?";if(I>0){const T=Math.round(O/I*100);b=T,n=100-T,n>=80?K="You are on fire! üî• Highly Focused.":n>=50?K="Good flow. Keep working! üí™":n>=30?K="Distractions are creeping in. ‚ö†Ô∏è":K="Procrastination is winning. Fight back! üõ°Ô∏è"}c(K);const V=y(m.REFLECTIONS,[]).sort((T,P)=>new Date(P.date)-new Date(T.date))[0],ct=V?V.tomorrowGoal:null;v({date:new Date().toISOString(),workScore:n,procrastinationScore:b,tasksDoneCount:ie,pointsScored:E,distractionTime:O,distractionCount:_,tomorrowGoal:ct,workTime:ne,isLive:!0})},R=ot();D(R),R&&R.length>0&&w(R[0]),z()},[]),e.jsx(W,{children:e.jsxs("div",{className:"container",style:{textAlign:"center",paddingTop:"2rem"},children:[S&&e.jsx("div",{style:{marginBottom:"1.5rem"},children:e.jsxs("button",{onClick:B,style:{background:"var(--color-primary)",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"2rem",display:"inline-flex",alignItems:"center",gap:"0.5rem",margin:"0 auto",cursor:"pointer",fontSize:"0.9rem",boxShadow:"0 4px 6px -1px rgba(99, 102, 241, 0.3)"},children:[e.jsx(fe,{size:16})," Install App"]})}),e.jsx("h1",{style:{fontSize:"2.5rem",marginBottom:"0.5rem",background:"linear-gradient(135deg, #6366f1 0%, #a855f7 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Productivity"}),e.jsx("p",{style:{fontSize:"1.2rem",color:"var(--color-text-secondary)",marginBottom:"2rem"},children:"Start small. Be kind to yourself."}),e.jsxs("div",{className:"card",style:{textAlign:"left",marginBottom:"2rem"},children:[e.jsxs("h3",{style:{margin:"0 0 1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(yt,{className:"text-secondary",size:20}),"Your Progress"]}),e.jsx("div",{style:{marginBottom:"1rem",padding:"0.75rem",background:"var(--color-bg-accent)",borderRadius:"var(--radius-md)",fontWeight:"500",color:"var(--color-primary)"},children:l}),x&&x.type!=="neutral"&&e.jsxs("div",{style:{marginBottom:"1rem",padding:"0.75rem",background:x.type==="warning"?"#fef2f2":x.type==="success"?"#f0fdf4":"#f0f9ff",borderRadius:"var(--radius-md)",border:x.type==="warning"?"1px solid #fecaca":x.type==="success"?"1px solid #bbf7d0":"1px solid #bae6fd",fontSize:"0.9rem",display:"flex",gap:"0.5rem",alignItems:"start"},children:[e.jsx(pe,{size:16,style:{marginTop:"2px",color:x.type==="warning"?"#ef4444":x.type==="success"?"#15803d":"#0284c7"}}),e.jsxs("span",{style:{color:x.type==="warning"?"#b91c1c":x.type==="success"?"#166534":"#0369a1"},children:[e.jsxs("strong",{children:[x.title,":"]})," ",x.text.replace(/\*\*/g,"")]})]}),e.jsxs("ul",{style:{paddingLeft:"1.5rem",color:"var(--color-text-secondary)",lineHeight:"1.6",marginBottom:"1rem"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:r})," Total Days Active"]}),e.jsxs("li",{children:[e.jsx("strong",{children:p})," Focus Points"]})]}),L.length>0&&e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.9rem",fontWeight:"bold",color:"var(--color-text-primary)",marginBottom:"0.75rem"},children:"Top Distractions Today:"}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:L.map((f,z)=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",background:"#fff1f2",padding:"0.75rem 1rem",borderRadius:"var(--radius-md)",borderLeft:"4px solid #f43f5e"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx(Ee,{size:16,color:"#f43f5e"}),e.jsx("span",{style:{color:"#be123c",fontWeight:"500"},children:f.name})]}),e.jsxs("span",{style:{fontWeight:"bold",color:"#be123c"},children:[f.duration,"m"]})]},z))})]})]}),e.jsx("div",{style:{marginTop:"2rem"},children:e.jsxs("button",{className:"btn-primary",onClick:()=>i("/mood"),children:["Get Started ",e.jsx(xt,{size:18,style:{marginLeft:"0.5rem"}})]})}),u&&e.jsxs("div",{style:{marginTop:"3rem",textAlign:"left"},children:[e.jsxs("h3",{style:{display:"flex",alignItems:"center",gap:"0.5rem",color:"var(--color-text-secondary)"},children:[e.jsx(Ue,{size:18}),"Today's Live Snapshot"]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",justifyContent:"center",gap:"2rem",flexWrap:"wrap"},children:[e.jsxs("div",{style:{width:"160px",height:"160px",position:"relative"},children:[e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ke,{children:[e.jsxs(Me,{data:[{name:"Work",value:u.workScore,color:"#10b981"},{name:"Procrastination",value:u.procrastinationScore,color:"#ef4444"}],dataKey:"value",innerRadius:50,outerRadius:70,startAngle:90,endAngle:-270,paddingAngle:5,children:[e.jsx(je,{fill:"#10b981"},"work"),e.jsx(je,{fill:"#ef4444"},"proc")]}),e.jsx(me,{})]})}),e.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:u.workScore>=50?"#10b981":"#ef4444"},children:[u.workScore,"%"]}),e.jsx("div",{style:{fontSize:"0.6rem",color:"var(--color-text-secondary)"},children:"Focus"})]})]}),e.jsxs("div",{style:{flex:1,minWidth:"150px"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"1rem"},children:[e.jsxs("div",{style:{textAlign:"center",padding:"0.5rem",background:"#f0fdf4",borderRadius:"8px"},children:[e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:"bold",color:"#15803d"},children:u.tasksDoneCount||0}),e.jsx("div",{style:{fontSize:"0.7rem",color:"#166534"},children:"Tasks Done"})]}),e.jsxs("div",{style:{textAlign:"center",padding:"0.5rem",background:"#fafaebb",borderRadius:"8px",border:"1px solid #fef08a"},children:[e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:"bold",color:"#854d0e"},children:u.pointsScored||0}),e.jsx("div",{style:{fontSize:"0.7rem",color:"#854d0e"},children:"Points"})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"0.85rem",color:"var(--color-text-secondary)"},children:[e.jsx("span",{children:"Worked:"}),e.jsxs("strong",{children:[u.workTime||0,"m"]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"0.85rem",color:"var(--color-text-secondary)",marginTop:"0.25rem"},children:[e.jsx("span",{children:"Distracted:"}),e.jsxs("strong",{children:[u.distractionTime||0,"m"]})]})]})]}),u.tomorrowGoal&&e.jsxs("div",{style:{padding:"0.75rem",background:"var(--color-bg-accent)",borderRadius:"var(--radius-md)",marginTop:"1rem"},children:[e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",display:"flex",alignItems:"center",gap:"0.25rem",marginBottom:"0.25rem"},children:[e.jsx(Ae,{size:12}),new Date(u.date).toDateString()===new Date().toDateString()?"Goal for Tomorrow":"Target"]}),e.jsx("div",{style:{fontWeight:500,fontSize:"0.9rem"},children:u.tomorrowGoal})]})]})]})]})})},er=(i,t={})=>{const s=new Date;let r="night";if(t.overrideTimeOfDay)r=t.overrideTimeOfDay;else{const l=s.getHours();l>=5&&l<12?r="morning":l>=12&&l<17?r="afternoon":l>=17&&l<21&&(r="evening")}const{overrideTimeOfDay:a,...p}=t,o=y(m.USER_MOOD,"neutral");return{event_id:crypto.randomUUID(),user_id:q.currentUser?q.currentUser.uid:"local_user",timestamp:s.toISOString(),date:s.toISOString().split("T")[0],time_of_day:r,event_type:i,mood_before:o,payload:p,synced:!1}},oe=(i,t)=>{const s=er(i,t),r=y(m.EVENT_LOG,[]);r.push(s),N(m.EVENT_LOG,r),tr()},tr=async()=>{const i=q.currentUser;if(!i)return;const t=y(m.EVENT_LOG,[]),s=t.filter(r=>!r.synced);if(s.length!==0)try{const r=Ut(ye),a=Kt(ye,"users",i.uid,"events");s.forEach(o=>{const l=Se(a,o.event_id),{synced:c,...x}=o;r.set(l,x)}),await r.commit();const p=t.map(o=>s.find(l=>l.event_id===o.event_id)?{...o,synced:!0}:o);N(m.EVENT_LOG,p),console.log(`Synced ${s.length} events to cloud.`)}catch(r){console.error("Failed to sync events:",r)}},rr=()=>{const i=G(),t=[{id:"focused",label:"Focused",icon:e.jsx(pe,{size:32}),color:"var(--color-success)",desc:"I'm ready to tackle something big."},{id:"low-energy",label:"Low Energy",icon:e.jsx(ht,{size:32}),color:"var(--color-warning)",desc:"I need something small and easy."},{id:"bored",label:"Bored",icon:e.jsx(ft,{size:32}),color:"var(--color-text-accent)",desc:"I need to get interested."}],s=r=>{N(m.USER_MOOD,r),oe("mood_update",{mood:r}),i("/tasks")};return e.jsx(W,{children:e.jsxs("div",{className:"container",children:[e.jsx("h2",{style:{textAlign:"center",marginBottom:"1rem"},children:"How are you feeling right now?"}),e.jsx("div",{style:{display:"grid",gap:"1rem"},children:t.map(r=>e.jsxs("button",{onClick:()=>s(r.id),className:"card",style:{display:"flex",alignItems:"center",gap:"1rem",textAlign:"left",width:"100%",border:"1px solid transparent",cursor:"pointer",transition:"transform 0.2s, border-color 0.2s"},onMouseEnter:a=>{a.currentTarget.style.transform="scale(1.02)",a.currentTarget.style.borderColor=r.color},onMouseLeave:a=>{a.currentTarget.style.transform="scale(1)",a.currentTarget.style.borderColor="transparent"},children:[e.jsx("div",{style:{color:r.color},children:r.icon}),e.jsxs("div",{children:[e.jsx("strong",{style:{display:"block",fontSize:"1.1rem"},children:r.label}),e.jsx("span",{style:{fontSize:"0.9rem",color:"var(--color-text-secondary)"},children:r.desc})]})]},r.id))})]})})},sr=()=>{const i=G(),[t,s]=d.useState([]),[r,a]=d.useState(null),[p,o]=d.useState([]),l=c=>{if(window.confirm("Are you sure you want to delete this task?")){const x=t.filter(D=>D.id!==c);s(x);const j=y(m.TASKS,[]).filter(D=>D.id!==c);N(m.TASKS,j)}};return d.useEffect(()=>{const c=y(m.USER_MOOD);a(c);const w=y(m.TASKS,[]).filter(A=>{var u;return!A.completed&&(((u=A.moods)==null?void 0:u.includes(c))||!A.moods||A.moods.length===0)});s(w);const j=y(m.SCHEDULED_TASKS,[]),D=new Date().setHours(0,0,0,0),L=j.filter(A=>{const u=new Date(A.startDate).setHours(0,0,0,0),v=new Date(A.dueDate).setHours(0,0,0,0);return!A.completed&&D>=u&&D<=v});o(L)},[]),e.jsx(W,{children:e.jsxs("div",{className:"container",children:[e.jsxs("button",{onClick:()=>i("/schedule"),style:{background:"transparent",border:"none",color:"var(--color-primary)",display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0",fontSize:"1rem",cursor:"pointer",marginBottom:"1rem"},children:[e.jsx(Y,{size:20})," Back"]}),p.length>0&&e.jsxs("div",{style:{background:"var(--color-bg-accent)",padding:"1rem",borderRadius:"var(--radius-md)",marginBottom:"1.5rem",border:"1px solid var(--color-primary)"},children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"start",color:"var(--color-primary)",marginBottom:"0.5rem"},children:[e.jsx(X,{size:20,style:{marginTop:"0.1rem"}}),e.jsxs("strong",{style:{display:"block"},children:["Daily Commitments (",p.length,")"]})]}),p.map(c=>e.jsx("div",{style:{marginLeft:"1.75rem",marginBottom:"0.5rem",borderBottom:"1px solid #e2e8f0",paddingBottom:"0.5rem"},children:e.jsxs("span",{style:{color:"var(--color-text-primary)"},children:["Planned to work on ",e.jsx("strong",{children:c.workToComplete})," for the ",e.jsx("strong",{children:c.name}),"."]})},c.id))]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[e.jsx("h2",{children:"Suggested for You"}),e.jsxs("button",{className:"btn-primary",style:{padding:"0.5rem 1rem",display:"flex",alignItems:"center",gap:"0.5rem"},onClick:()=>i("/add-task"),children:[e.jsx(he,{size:18})," Add Task"]})]}),t.length===0?e.jsxs("div",{style:{textAlign:"center",color:"var(--color-text-secondary)",padding:"2rem"},children:[e.jsxs("p",{children:["No tasks fit your current mood (",r,")."]}),e.jsx("p",{children:"Why not add a small one?"})]}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:t.map(c=>e.jsxs("div",{className:"card",children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start"},children:e.jsxs("div",{children:[e.jsx("h3",{style:{margin:"0 0 0.25rem",fontSize:"1.25rem"},children:c.title}),e.jsxs("p",{style:{fontSize:"0.9rem",marginBottom:"0.5rem"},children:[e.jsx("strong",{children:"Start with:"})," ",c.smallStep]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.85rem",color:"var(--color-text-secondary)"},children:c.time&&e.jsxs(e.Fragment,{children:[e.jsx(He,{size:16})," ",c.time]})})]})}),e.jsxs("div",{style:{marginTop:"1rem",textAlign:"right"},children:[e.jsx("button",{className:"btn-primary",style:{background:"var(--color-success)",fontSize:"0.9rem"},onClick:()=>i(`/complete/${c.id}`),children:"Task Done (Add Proof)"}),e.jsx("button",{style:{background:"transparent",border:"none",color:"#ef4444",marginLeft:"1rem",cursor:"pointer",padding:"0.5rem"},onClick:()=>l(c.id),"aria-label":"Delete task",children:e.jsx(ue,{size:18})})]})]},c.id))})]})})},nr=()=>{const i=G(),[t,s]=d.useState({title:"",smallStep:"",moods:[],reminderTime:"",frequency:"once",repeatDays:[]}),r=[{id:"focused",label:"Focused"},{id:"low-energy",label:"Low Energy"},{id:"bored",label:"Bored"}],a=o=>{o.preventDefault();const l=y(m.TASKS,[]),c={id:Date.now().toString(),...t,completed:!1,createdAt:new Date().toISOString()};N(m.TASKS,[c,...l]),oe("task_create",{task_id:c.id,title:c.title}),i("/tasks")},p=o=>{s(l=>{const c=l.moods.includes(o)?l.moods.filter(x=>x!==o):[...l.moods,o];return{...l,moods:c}})};return e.jsx(W,{children:e.jsxs("div",{className:"container",children:[e.jsxs("button",{onClick:()=>i("/schedule"),style:{background:"transparent",border:"none",color:"var(--color-primary)",display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0",fontSize:"1rem",cursor:"pointer",marginBottom:"1rem"},children:[e.jsx(Y,{size:20})," Back"]}),e.jsx("h2",{children:"Add a New Task"}),e.jsxs("form",{onSubmit:a,className:"card",children:[e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{children:"Task Name"}),e.jsx("input",{required:!0,value:t.title,onChange:o=>s({...t,title:o.target.value}),placeholder:"e.g. Study Math"})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{children:"Small First Step (Crucial!)"}),e.jsx("input",{required:!0,value:t.smallStep,onChange:o=>s({...t,smallStep:o.target.value}),placeholder:"e.g. Open the textbook to page 50"}),e.jsx("small",{style:{color:"var(--color-text-secondary)"},children:"Just write what you will do in the first 2 minutes."})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{children:"Best for Mood (Optional)"}),e.jsx("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:r.map(o=>e.jsx("button",{type:"button",onClick:()=>p(o.id),style:{padding:"0.5rem 1rem",borderRadius:"var(--radius-full)",border:"1px solid var(--color-primary)",background:t.moods.includes(o.id)?"var(--color-primary)":"transparent",color:t.moods.includes(o.id)?"white":"var(--color-primary)",fontSize:"0.85rem"},children:o.label},o.id))})]}),e.jsxs("div",{style:{marginBottom:"1.5rem",padding:"1rem",background:"var(--color-bg-secondary)",borderRadius:"var(--radius-md)"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem",fontWeight:"bold"},children:[e.jsx(X,{size:16})," Reminder & frequency"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"0.85rem"},children:"Time"}),e.jsx("input",{type:"time",value:t.reminderTime,onChange:o=>s({...t,reminderTime:o.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"0.85rem"},children:"Frequency"}),e.jsxs("select",{value:t.frequency,onChange:o=>s({...t,frequency:o.target.value}),style:{width:"100%",padding:"0.5rem",borderRadius:"4px",border:"1px solid #cbd5e1"},children:[e.jsx("option",{value:"once",children:"Once (Today)"}),e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"custom",children:"Custom Days"})]})]})]}),t.frequency==="custom"&&e.jsx("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map(o=>e.jsx("button",{type:"button",onClick:()=>{const l=t.repeatDays.includes(o)?t.repeatDays.filter(c=>c!==o):[...t.repeatDays,o];s({...t,repeatDays:l})},style:{padding:"0.25rem 0.5rem",fontSize:"0.75rem",borderRadius:"4px",border:"1px solid var(--color-primary)",background:t.repeatDays.includes(o)?"var(--color-primary)":"white",color:t.repeatDays.includes(o)?"white":"var(--color-primary)"},children:o},o))})]}),e.jsx("button",{type:"submit",className:"btn-primary",style:{width:"100%"},children:"Save Task"})]})]})})},ze=({value:i,onChange:t})=>e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem",marginTop:"0.5rem"},children:[["15","30","45","60"].map(s=>e.jsxs("button",{type:"button",onClick:()=>t(s),style:{padding:"0.5rem 1rem",borderRadius:"2rem",border:"1px solid var(--color-primary)",background:i===s?"var(--color-primary)":"transparent",color:i===s?"white":"var(--color-primary)",cursor:"pointer",transition:"all 0.2s"},children:[s,"m"]},s)),e.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",placeholder:"Custom (max 600)",value:i,onChange:s=>{const r=s.target.value;(r===""||/^\d+$/.test(r)&&parseInt(r,10)<=600)&&t(r)},style:{width:"120px",padding:"0.5rem",borderRadius:"var(--radius-md)",border:"1px solid #cbd5e1",outlineColor:"var(--color-primary)"}})]}),ve=({value:i,onChange:t,compact:s=!1})=>{const r=[{id:"morning",label:"Morning",icon:e.jsx(Ie,{size:20}),color:"#f59e0b"},{id:"afternoon",label:"Afternoon",icon:e.jsx(jt,{size:20}),color:"#ea580c"},{id:"evening",label:"Evening",icon:e.jsx(vt,{size:20}),color:"#7c3aed"},{id:"night",label:"Night",icon:e.jsx(Ce,{size:20}),color:"#1e293b"}];return e.jsxs("div",{style:{marginBottom:s?0:"1.5rem"},children:[!s&&e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"500",color:"var(--color-text-secondary)"},children:"When did this happen?"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:s?"repeat(4, auto)":"repeat(4, 1fr)",gap:s?"0.25rem":"0.5rem"},children:r.map(a=>e.jsxs("button",{type:"button",onClick:()=>t(a.id),title:s?a.label:"",style:{display:"flex",flexDirection:s?"row":"column",alignItems:"center",justifyContent:"center",gap:"0.25rem",padding:s?"0.4rem":"0.75rem 0.25rem",borderRadius:"var(--radius-md)",border:`1px solid ${i===a.id?a.color:"transparent"}`,background:i===a.id?`${a.color}15`:"var(--color-bg-secondary)",color:i===a.id?a.color:"var(--color-text-secondary)",cursor:"pointer",transition:"all 0.2s"},children:[a.icon,!s&&e.jsx("span",{style:{fontSize:"0.75rem",fontWeight:i===a.id?"600":"400"},children:a.label})]},a.id))})]})},or=()=>{const{taskId:i}=St(),t=G(),[s,r]=d.useState(null),[a,p]=d.useState(""),[o,l]=d.useState(""),[c,x]=d.useState(null),w=d.useRef(null),j=d.useRef(null),[D,L]=d.useState(!1),[A,u]=d.useState(0),[v,S]=d.useState("morning");d.useEffect(()=>{const f=new Date().getHours();f>=5&&f<12?S("morning"):f>=12&&f<17?S("afternoon"):f>=17&&f<21?S("evening"):S("night")},[]),d.useEffect(()=>{let z=y(m.TASKS,[]).find(R=>R.id===i);if(!z){const M=y(m.SCHEDULED_TASKS,[]).find(k=>String(k.id)===i);M&&(z={...M,title:M.name,smallStep:M.workToComplete||"Scheduled Work",isSchedule:!0})}z&&r(z)},[i]);const F=f=>{const z=f.target.files[0];if(z){const R=new FileReader;R.onloadend=()=>{x(R.result)},R.readAsDataURL(z)}},B=f=>{f.preventDefault();const z=new Date().setHours(0,0,0,0);let R=10;if(s.isSchedule){const k=new Date(s.dueDate).setHours(0,0,0,0);z<=k?R=100:R=10}const M=parseInt(o)||0;if(R+=M,s.isSchedule){const O=y(m.SCHEDULED_TASKS,[]).map(_=>String(_.id)===i?{..._,completed:!0,completedAt:new Date().toISOString(),timeTaken:parseInt(o)||0,proofImage:c,pointsEarned:R}:_);N(m.SCHEDULED_TASKS,O)}else{const O=y(m.TASKS,[]).map(_=>_.id===i?{..._,completed:!0,learning:a,completedAt:new Date().toISOString(),timeTaken:parseInt(o)||0,proofImage:c,pointsEarned:R}:_);N(m.TASKS,O)}ke(R),tt(),oe("task_complete",{task_id:i,task_title:s.title,actual_time_spent:parseInt(o)||0,points_earned:R,has_proof:!!c,learning_note:a,overrideTimeOfDay:v}),u(R),L(!0)};return s?D?e.jsx(W,{children:e.jsxs("div",{className:"container",style:{textAlign:"center",padding:"3rem 1rem"},children:[e.jsx(ge,{size:64,color:"var(--color-success)",style:{margin:"0 auto 1rem"}}),e.jsx("h2",{children:"Well Done!"}),e.jsx("p",{children:"You started despite resistance. That matters."}),e.jsxs("div",{style:{margin:"2rem 0",padding:"1.5rem",background:"var(--color-bg-accent)",borderRadius:"var(--radius-lg)"},children:[e.jsxs("h3",{style:{margin:0,color:"var(--color-primary)"},children:["+",A," Focus Points"]}),e.jsx("p",{style:{margin:"0.5rem 0 0"},children:"Streak Updated!"})]}),e.jsx("button",{className:"btn-primary",onClick:()=>t("/"),children:"Back Home"})]})}):e.jsx(W,{children:e.jsxs("div",{className:"container",children:[e.jsxs("h2",{children:['Complete "',s.title,'"']}),e.jsx("div",{className:"card",children:e.jsxs("form",{onSubmit:B,children:[e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{children:"Time Taken (minutes)"}),e.jsx(ze,{value:o,onChange:l})]}),e.jsx(ve,{value:v,onChange:S}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{children:"What did you learn or do? (Optional)"}),e.jsx("textarea",{value:a,onChange:f=>p(f.target.value),placeholder:"I learned that starting wasn't so bad...",rows:2})]}),e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem"},children:"Upload Proof (Optional)"}),e.jsx("input",{type:"file",accept:"image/*",ref:w,onChange:F,style:{display:"none"}}),e.jsx("input",{type:"file",accept:"image/*",capture:"environment",id:"cameraInput",ref:j,onChange:F,style:{display:"none"}}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{onClick:()=>{var f;return(f=w.current)==null?void 0:f.click()},style:{border:"2px dashed #cbd5e1",borderRadius:"var(--radius-md)",padding:"1.5rem",textAlign:"center",color:"var(--color-text-secondary)",cursor:"pointer",background:c?"#f0fdf4":"transparent"},children:[e.jsx(Ge,{size:24,style:{marginBottom:"0.5rem"}}),e.jsx("div",{children:"Upload Image"})]}),e.jsxs("div",{onClick:()=>{var f;return(f=j.current)==null?void 0:f.click()},style:{border:"2px dashed #cbd5e1",borderRadius:"var(--radius-md)",padding:"1.5rem",textAlign:"center",color:"var(--color-text-secondary)",cursor:"pointer",background:c?"#f0fdf4":"transparent"},children:[e.jsx(qe,{size:24,style:{marginBottom:"0.5rem"}}),e.jsx("div",{children:"Take Photo"})]})]}),c&&e.jsx("div",{style:{marginTop:"0.5rem",fontSize:"0.875rem",color:"var(--color-success)",textAlign:"center"},children:"Proof Attached!"})]}),e.jsx("button",{type:"submit",className:"btn-primary",style:{width:"100%",opacity:o?1:.5,cursor:o?"pointer":"not-allowed"},disabled:!o,children:"Mark as Completed"})]})})]})}):e.jsx(W,{children:e.jsx("div",{children:"Loading..."})})},ir=()=>{const i=G(),[t,s]=d.useState([]),[r,a]=d.useState([]),[p,o]=d.useState(null),[l,c]=d.useState(""),[x,w]=d.useState("morning"),[j,D]=d.useState(!1),[L,A]=d.useState(!1),[u,v]=d.useState(!1),[S,F]=d.useState(""),[B,f]=d.useState(""),[z,R]=d.useState(null),M=d.useRef(null),k=d.useRef(null),[O,_]=d.useState("morning"),[C,g]=d.useState({name:"",workToComplete:"",startDate:"",dueDate:"",reminderTime:"",frequency:"once",repeatDays:[]}),[h,U]=d.useState({title:"",smallStep:"",moods:[],reminderTime:"",frequency:"once",repeatDays:[]}),[Z,$]=d.useState(null),te=[{id:"focused",label:"Focused"},{id:"low-energy",label:"Low Energy"},{id:"bored",label:"Bored"}];d.useEffect(()=>{s(y(m.SCHEDULED_TASKS,[])),a(y(m.TASKS,[]))},[]);const J=n=>{if(n.preventDefault(),!p||!l)return;const b=parseInt(l);if(isNaN(b)||b<=0)return;const I={id:Date.now().toString(),taskId:p.id,taskTitle:p.title||p.name,duration:b,timeOfDay:x,date:new Date().toISOString()},K=y(m.WORK_LOGS,[]);N(m.WORK_LOGS,[...K,I]),ke(b),o(null),c(""),alert(`Logged ${b} mins of work! Keep it up.`)},xe=n=>{if(n.preventDefault(),Z){const b=t.map(I=>I.id===Z?{...I,...C}:I);N(m.SCHEDULED_TASKS,b),s(b),$(null)}else{const b=[...t,{id:Date.now(),...C}];N(m.SCHEDULED_TASKS,b),s(b)}D(!1),D(!1),g({name:"",workToComplete:"",startDate:"",dueDate:"",reminderTime:"",frequency:"once",repeatDays:[]})},re=n=>{g({name:n.name,workToComplete:n.workToComplete||"",startDate:n.startDate,dueDate:n.dueDate,reminderTime:n.reminderTime||"",frequency:n.frequency||"once",repeatDays:n.repeatDays||[]}),$(n.id),D(!0),A(!1),v(!1)},se=n=>{n.preventDefault();const I=[{id:Date.now().toString(),...h,completed:!1,createdAt:new Date().toISOString()},...r];N(m.TASKS,I),a(I),A(!1),A(!1),U({title:"",smallStep:"",moods:[],reminderTime:"",frequency:"once",repeatDays:[]})},ne=n=>{if(window.confirm("Delete this daily task?")){const b=r.filter(I=>I.id!==n);a(b),N(m.TASKS,b)}},ie=n=>{if(window.confirm("Cancel this future plan?")){const b=t.filter(I=>I.id!==n);s(b),N(m.SCHEDULED_TASKS,b)}},ae=n=>{U(b=>{const I=b.moods.includes(n)?b.moods.filter(K=>K!==n):[...b.moods,n];return{...b,moods:I}})},Q=n=>{const b=n.target.files[0];if(b){const I=new FileReader;I.onloadend=()=>{R(I.result)},I.readAsDataURL(b)}},E=n=>{n.preventDefault();const I=10+(parseInt(B)||0),K=y(m.TASKS,[]),ee={id:Date.now().toString(),title:S,smallStep:"Ad-hoc Logged",time:B,completed:!0,completedAt:new Date().toISOString(),timeTaken:parseInt(B)||0,proofImage:z,isAdhoc:!0,pointsEarned:I};N(m.TASKS,[ee,...K]),a([ee,...K]),ke(I),tt(),oe("task_complete",{task_id:ee.id,task_title:ee.title,actual_time_spent:parseInt(B)||0,points_earned:I,has_proof:!!z,is_adhoc:!0}),alert(`Saved! +${I} Points.`),v(!1),F(""),f(""),R(null)};return e.jsx(W,{children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"2rem"},children:[e.jsxs("button",{onClick:()=>i("/"),style:{background:"var(--color-bg-secondary)",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",color:"var(--color-primary)",padding:"0.5rem 1rem",borderRadius:"2rem",fontWeight:"500",marginRight:"1rem"},children:[e.jsx(Y,{size:18})," Back"]}),e.jsx("h2",{style:{margin:0},children:"Planning Hub"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"3rem"},children:[e.jsxs("div",{className:"card",style:{textAlign:"center",cursor:"pointer",border:L?"2px solid var(--color-primary)":"1px solid transparent",transition:"all 0.2s",padding:"2rem 1rem"},onClick:()=>{A(!L),D(!1),v(!1)},children:[e.jsx("div",{style:{background:"var(--color-bg-accent)",width:"48px",height:"48px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 1rem",color:"var(--color-primary)"},children:e.jsx(pe,{size:24})}),e.jsx("h3",{style:{fontSize:"1.2rem",margin:"0 0 0.5rem"},children:"Add Task"}),e.jsx("p",{style:{fontSize:"0.9rem",color:"var(--color-text-secondary)",margin:0},children:"For immediate work today. Small steps."})]}),e.jsxs("div",{className:"card",style:{textAlign:"center",cursor:"pointer",border:j?"2px solid var(--color-primary)":"1px solid transparent",padding:"2rem 1rem"},onClick:()=>{D(!j),A(!1),v(!1)},children:[e.jsx("div",{style:{background:"#f0f9ff",width:"48px",height:"48px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 1rem",color:"#0284c7"},children:e.jsx(Ae,{size:24})}),e.jsx("h3",{style:{fontSize:"1.2rem",margin:"0 0 0.5rem"},children:"Schedule Future Task"}),e.jsx("p",{style:{fontSize:"0.9rem",color:"var(--color-text-secondary)",margin:0},children:"Plan ahead to reduce uncertainty."})]})]}),L&&e.jsxs("div",{style:{animation:"fadeIn 0.3s ease-in-out"},children:[e.jsx("h3",{style:{marginBottom:"1rem"},children:"Add a New Task"}),e.jsxs("form",{onSubmit:se,className:"card",style:{marginBottom:"3rem",borderLeft:"4px solid var(--color-primary)"},children:[e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{children:"Task Name"}),e.jsx("input",{required:!0,value:h.title,onChange:n=>U({...h,title:n.target.value}),placeholder:"e.g. Study Math",autoFocus:!0})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{children:"Small First Step (Crucial!)"}),e.jsx("input",{required:!0,value:h.smallStep,onChange:n=>U({...h,smallStep:n.target.value}),placeholder:"e.g. Open the textbook to page 50"}),e.jsx("small",{style:{color:"var(--color-text-secondary)"},children:"Just write what you will do in the first 2 minutes."})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{children:"Best for Mood (Optional)"}),e.jsx("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:te.map(n=>e.jsx("button",{type:"button",onClick:()=>ae(n.id),style:{padding:"0.5rem 1rem",borderRadius:"var(--radius-full)",border:"1px solid var(--color-primary)",background:h.moods.includes(n.id)?"var(--color-primary)":"transparent",color:h.moods.includes(n.id)?"white":"var(--color-primary)",fontSize:"0.85rem"},children:n.label},n.id))})]}),e.jsxs("div",{style:{marginBottom:"1.5rem",padding:"1rem",background:"var(--color-bg-secondary)",borderRadius:"var(--radius-md)"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem",fontWeight:"bold"},children:[e.jsx(X,{size:16})," Reminder & frequency"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"0.85rem"},children:"Time"}),e.jsx("input",{type:"time",value:h.reminderTime,onChange:n=>U({...h,reminderTime:n.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"0.85rem"},children:"Frequency"}),e.jsxs("select",{value:h.frequency,onChange:n=>U({...h,frequency:n.target.value}),style:{width:"100%",padding:"0.5rem",borderRadius:"4px",border:"1px solid #cbd5e1"},children:[e.jsx("option",{value:"once",children:"Once (Today)"}),e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"custom",children:"Custom Days"})]})]})]}),h.frequency==="custom"&&e.jsx("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map(n=>e.jsx("button",{type:"button",onClick:()=>{const b=h.repeatDays.includes(n)?h.repeatDays.filter(I=>I!==n):[...h.repeatDays,n];U({...h,repeatDays:b})},style:{padding:"0.25rem 0.5rem",fontSize:"0.75rem",borderRadius:"4px",border:"1px solid var(--color-primary)",background:h.repeatDays.includes(n)?"var(--color-primary)":"white",color:h.repeatDays.includes(n)?"white":"var(--color-primary)"},children:n},n))})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem"},children:[e.jsx("button",{type:"button",onClick:()=>A(!1),className:"btn-secondary",style:{flex:1},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",style:{flex:1},children:"Save Task"})]})]})]}),j&&e.jsxs("div",{style:{animation:"fadeIn 0.3s ease-in-out"},children:[e.jsx("h3",{style:{marginBottom:"1rem"},children:Z?"Edit Plan":"New Future Plan"}),e.jsxs("form",{onSubmit:xe,className:"card",style:{marginBottom:"3rem",borderLeft:"4px solid #0284c7"},children:[e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{children:"Task Name"}),e.jsx("input",{required:!0,value:C.name,onChange:n=>g({...C,name:n.target.value}),autoFocus:!0})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{children:"Work to Complete"}),e.jsx("input",{value:C.workToComplete,onChange:n=>g({...C,workToComplete:n.target.value}),placeholder:"e.g. Read Chapters 1-3"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{children:"Start Date"}),e.jsx("input",{type:"date",required:!0,value:C.startDate,onChange:n=>g({...C,startDate:n.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Due Date"}),e.jsx("input",{type:"date",required:!0,value:C.dueDate,onChange:n=>g({...C,dueDate:n.target.value})})]})]}),e.jsxs("div",{style:{marginBottom:"1.5rem",padding:"1rem",background:"var(--color-bg-secondary)",borderRadius:"var(--radius-md)"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem",fontWeight:"bold"},children:[e.jsx(X,{size:16})," Daily Reminder"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"0.85rem"},children:"Time"}),e.jsx("input",{type:"time",value:C.reminderTime,onChange:n=>g({...C,reminderTime:n.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"0.85rem"},children:"Working Days"}),e.jsxs("select",{value:C.frequency,onChange:n=>g({...C,frequency:n.target.value}),style:{width:"100%",padding:"0.5rem",borderRadius:"4px",border:"1px solid #cbd5e1"},children:[e.jsx("option",{value:"once",children:"Every Day (Default)"}),e.jsx("option",{value:"daily",children:"Every Day"}),e.jsx("option",{value:"custom",children:"Custom Days"})]})]})]}),C.frequency==="custom"&&e.jsx("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map(n=>e.jsx("button",{type:"button",onClick:()=>{const b=C.repeatDays.includes(n)?C.repeatDays.filter(I=>I!==n):[...C.repeatDays,n];g({...C,repeatDays:b})},style:{padding:"0.25rem 0.5rem",fontSize:"0.75rem",borderRadius:"4px",border:"1px solid var(--color-primary)",background:C.repeatDays.includes(n)?"var(--color-primary)":"white",color:C.repeatDays.includes(n)?"white":"var(--color-primary)"},children:n},n))})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem"},children:[e.jsx("button",{type:"button",onClick:()=>D(!1),className:"btn-secondary",style:{flex:1},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",style:{flex:1},children:"Save Plan"})]})]})]}),u&&e.jsxs("div",{style:{animation:"fadeIn 0.3s ease-in-out"},children:[e.jsx("h3",{style:{marginBottom:"1rem"},children:"Log Unplanned Work"}),e.jsxs("form",{onSubmit:E,className:"card",style:{marginBottom:"3rem",borderLeft:"4px solid #8b5cf6"},children:[e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{children:"What did you do?"}),e.jsx("input",{required:!0,value:S,onChange:n=>F(n.target.value),placeholder:"e.g. Helper a friend",autoFocus:!0})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{children:"Time Taken (minutes)"}),e.jsx(ze,{value:B,onChange:f})]}),e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem"},children:"Upload Proof (Optional)"}),e.jsx("input",{type:"file",accept:"image/*",ref:M,onChange:Q,style:{display:"none"}}),e.jsx("input",{type:"file",accept:"image/*",capture:"environment",ref:k,onChange:Q,style:{display:"none"}}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{onClick:()=>{var n;return(n=M.current)==null?void 0:n.click()},style:{border:"2px dashed #cbd5e1",borderRadius:"var(--radius-md)",padding:"1rem",textAlign:"center",cursor:"pointer",background:z?"#f0fdf4":"transparent"},children:[e.jsx(Ge,{size:24,style:{marginBottom:"0.5rem"}}),e.jsx("div",{children:"Upload"})]}),e.jsxs("div",{onClick:()=>{var n;return(n=k.current)==null?void 0:n.click()},style:{border:"2px dashed #cbd5e1",borderRadius:"var(--radius-md)",padding:"1rem",textAlign:"center",cursor:"pointer",background:z?"#f0fdf4":"transparent"},children:[e.jsx(qe,{size:24,style:{marginBottom:"0.5rem"}}),e.jsx("div",{children:"Camera"})]})]}),z&&e.jsx("div",{style:{marginTop:"0.5rem",fontSize:"0.875rem",color:"var(--color-success)",textAlign:"center"},children:"Proof Attached!"})]}),e.jsx(ve,{value:O,onChange:_}),e.jsxs("div",{style:{display:"flex",gap:"1rem"},children:[e.jsx("button",{type:"button",onClick:()=>v(!1),className:"btn-secondary",style:{flex:1},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",style:{flex:1,opacity:B?1:.5,cursor:B?"pointer":"not-allowed"},disabled:!B,children:"Save Work"})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1.5rem"},children:[e.jsx(bt,{size:20,className:"text-secondary"}),e.jsx("h3",{style:{margin:0,color:"var(--color-text-secondary)"},children:"Your Plans"}),e.jsx("div",{style:{flex:1}}),e.jsx("button",{onClick:()=>{v(!u),A(!1),D(!1)},style:{background:"var(--color-bg-secondary)",border:"none",padding:"0.5rem 1rem",borderRadius:"var(--radius-full)",color:"var(--color-primary)",fontSize:"0.85rem",fontWeight:"500",cursor:"pointer"},children:"+ Log Other Task"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[r.length>0&&r.some(n=>!n.completed)&&e.jsx("h4",{style:{margin:"1rem 0 0.5rem",color:"var(--color-primary)",borderBottom:"1px solid #e2e8f0",paddingBottom:"0.25rem"},children:"Daily Commitments"}),r.filter(n=>!n.completed).map(n=>e.jsxs("div",{className:"card",style:{borderLeft:"4px solid var(--color-warning)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.25rem"},children:[e.jsx("h3",{style:{margin:0},children:n.title}),e.jsx("span",{style:{fontSize:"0.75rem",background:"#fef3c7",color:"#d97706",padding:"0.1rem 0.4rem",borderRadius:"4px"},children:"Now"})]}),e.jsx("p",{style:{margin:"0 0 0.5rem",color:"var(--color-text-primary)"},children:n.smallStep})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"0.2rem"},children:[n.reminderTime&&e.jsxs("span",{style:{fontSize:"0.7rem",color:"var(--color-primary)",display:"flex",alignItems:"center",gap:"0.2rem"},children:[e.jsx(X,{size:10})," ",n.reminderTime]}),n.frequency==="custom"&&e.jsx("span",{style:{fontSize:"0.65rem",color:"var(--color-text-secondary)"},children:n.repeatDays.join(", ")}),n.frequency==="daily"&&e.jsx("span",{style:{fontSize:"0.65rem",color:"var(--color-text-secondary)"},children:"Daily"})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",marginTop:"1rem",paddingTop:"0.75rem",borderTop:"1px solid #eee",gap:"0.5rem"},children:[e.jsxs("button",{className:"btn-primary",style:{background:"var(--color-success)",fontSize:"0.85rem",padding:"0.5rem 1rem"},onClick:()=>i(`/complete/${n.id}`),children:[e.jsx(ge,{size:16,style:{marginRight:"0.25rem"}})," Task Done"]}),e.jsxs("button",{style:{background:"#fee2e2",border:"none",color:"#ef4444",cursor:"pointer",padding:"0.5rem 1rem",borderRadius:"2rem",fontSize:"0.85rem",display:"flex",alignItems:"center",gap:"0.25rem"},onClick:()=>ne(n.id),children:[e.jsx(ue,{size:16})," Delete"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--color-text-secondary)",marginLeft:"auto"},children:n.time&&`${n.time}m`})]})]},n.id)),t.length>0&&e.jsx("h4",{style:{margin:"1.5rem 0 0.5rem",color:"#0284c7",borderBottom:"1px solid #e2e8f0",paddingBottom:"0.25rem"},children:"Future Schedule"}),t.map(n=>{const b=new Date().setHours(0,0,0,0),I=new Date(n.startDate).setHours(0,0,0,0),K=new Date(n.dueDate).setHours(0,0,0,0),ee=b>=I&&b<=K;return K<b||n.completed?null:e.jsxs("div",{className:"card",style:{borderLeft:"4px solid var(--color-primary)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start"},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{margin:"0 0 0.25rem"},children:n.name}),e.jsx("p",{style:{margin:"0 0 0.5rem",color:"var(--color-text-primary)"},children:n.workToComplete}),n.reminderTime&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--color-primary)",display:"flex",alignItems:"center",gap:"0.4rem",marginTop:"0.2rem"},children:[e.jsx(X,{size:12}),"Reminder: ",n.reminderTime,n.frequency==="custom"&&` (${n.repeatDays.join(", ")})`,n.frequency==="daily"&&" (Daily)"]})]}),ee&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",color:"var(--color-primary)",fontSize:"0.8rem",fontWeight:"bold",background:"var(--color-bg-accent)",padding:"0.25rem 0.5rem",borderRadius:"var(--radius-md)"},children:[e.jsx(X,{size:14}),"Active Today"]})]}),e.jsxs("div",{style:{marginTop:"0.5rem",marginBottom:"1rem",fontSize:"0.85rem",color:"var(--color-text-secondary)"},children:[e.jsxs("span",{style:{marginRight:"1rem"},children:["Start: ",n.startDate]}),e.jsxs("span",{children:["Due: ",n.dueDate]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",flexWrap:"wrap",gap:"0.75rem",marginTop:"1rem",paddingTop:"1rem",borderTop:"1px solid #e2e8f0"},children:[e.jsxs("button",{className:"btn-secondary",style:{fontSize:"0.8rem",padding:"0.5rem 1rem",display:"flex",alignItems:"center",gap:"0.25rem"},onClick:()=>o(n),children:[e.jsx(pe,{size:14})," Done some work"]}),e.jsxs("button",{className:"btn-primary",style:{background:"var(--color-success)",fontSize:"0.85rem",padding:"0.5rem 1rem",display:"flex",alignItems:"center",gap:"0.25rem"},onClick:()=>i(`/complete/${n.id}`),children:[e.jsx(ge,{size:16})," Task Done"]}),e.jsxs("button",{onClick:()=>re(n),style:{background:"#fef3c7",color:"#d97706",border:"none",cursor:"pointer",padding:"0.5rem 1rem",borderRadius:"2rem",fontSize:"0.8rem",display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx($e,{size:14})," Edit"]}),e.jsxs("button",{style:{background:"#fee2e2",border:"none",color:"#ef4444",cursor:"pointer",padding:"0.5rem 1rem",borderRadius:"2rem",fontSize:"0.8rem",display:"flex",alignItems:"center",gap:"0.25rem"},onClick:()=>ie(n.id),children:[e.jsx(ue,{size:14})," Delete"]})]}),(p==null?void 0:p.id)===n.id&&e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",background:"var(--color-bg-secondary)",borderRadius:"var(--radius-md)"},children:[e.jsx("h4",{style:{margin:"0 0 0.5rem"},children:"Log Work (Not Done Yet)"}),e.jsxs("form",{onSubmit:J,style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",placeholder:"Mins",value:l,onChange:Re=>{const V=Re.target.value;(V===""||/^\d+$/.test(V)&&parseInt(V,10)<=600)&&c(V)},style:{width:"80px",padding:"0.5rem",borderRadius:"4px",border:"1px solid #cbd5e1"},autoFocus:!0}),e.jsx(ve,{value:x,onChange:w,compact:!0})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsxs("button",{type:"submit",className:"btn-primary",style:{padding:"0.25rem 0.75rem",fontSize:"0.85rem",flex:1,opacity:l?1:.5},disabled:!l,children:[e.jsx(Dt,{size:14})," Save"]}),e.jsx("button",{type:"button",onClick:()=>{o(null),c("")},style:{background:"transparent",border:"none",cursor:"pointer",color:"var(--color-text-secondary)"},children:e.jsx(Ye,{size:18})})]})]})]})]},n.id)}),r.length===0&&t.length===0&&e.jsx("p",{style:{textAlign:"center",padding:"2rem",background:"var(--color-bg-secondary)",borderRadius:"var(--radius-md)"},children:"No plans yet. Clear mind, clear path."})]})]})]})})},ar=()=>{const i=G(),[t,s]=d.useState(0),[r,a]=d.useState(0),[p,o]=d.useState(""),[l,c]=d.useState([]),[x,w]=d.useState([]),[j,D]=d.useState([]),[L,A]=d.useState(!1),[u,v]=d.useState(0),[S,F]=d.useState(0),[B,f]=d.useState(0),[z,R]=d.useState(0);d.useEffect(()=>{const k=new Date().setHours(0,0,0,0),_=y(m.DISTRACTION_LOGS,[]).filter(E=>new Date(E.date).setHours(0,0,0,0)===k);c(_);const C=_.reduce((E,n)=>E+parseInt(n.duration||0),0);F(C);const g=y(m.TASKS,[]),h=y(m.SCHEDULED_TASKS,[]),U=g.filter(E=>!E.completed||!E.completedAt?!1:new Date(E.completedAt).setHours(0,0,0,0)===k),Z=h.filter(E=>!E.completed||!E.completedAt?!1:new Date(E.completedAt).setHours(0,0,0,0)===k),$=[...U,...Z];w($);const J=y(m.WORK_LOGS,[]).filter(E=>new Date(E.date).setHours(0,0,0,0)===k);D(J);const xe=$.reduce((E,n)=>E+(parseInt(n.timeTaken)||0),0),re=J.reduce((E,n)=>E+parseInt(n.duration||0),0),se=xe+re;v(se);const ne=$.length+J.length;f(ne);const ie=$.reduce((E,n)=>n.pointsEarned!==void 0?E+n.pointsEarned:E+10+(parseInt(n.timeTaken)||0),0),ae=J.reduce((E,n)=>E+(parseInt(n.duration)||0),0);R(ie+ae);const Q=se+C;if(Q>0){const E=Math.round(C/Q*100);s(E),a(100-E)}else a(0),s(0)},[]);const M=k=>{k.preventDefault();const O=y(m.REFLECTIONS,[]),_={id:Date.now(),date:new Date().toISOString(),procrastinationScore:t,workScore:r,tomorrowGoal:p,distractionCount:l.length,distractionTime:S,tasksDoneCount:B,taskTime:u,pointsScored:z};N(m.REFLECTIONS,[_,...O]),oe("diary_entry",{procrastination_score:t,work_score:r,tomorrow_goal:p,total_distraction_time:S,total_work_time:u}),A(!0)};return L?e.jsx(W,{children:e.jsxs("div",{className:"container",style:{textAlign:"center",paddingTop:"3rem"},children:[e.jsx("div",{style:{fontSize:"4rem",marginBottom:"1rem"},children:"üåô"}),e.jsx("h2",{children:"Reflection Saved"}),e.jsx("p",{children:"Rest well. Tomorrow is a fresh start."}),e.jsx("button",{className:"btn-primary",onClick:()=>i("/"),style:{marginTop:"2rem"},children:"Back Home"}),e.jsxs("div",{style:{marginTop:"2rem",padding:"1.5rem",background:"var(--color-bg-accent)",borderRadius:"var(--radius-lg)",textAlign:"left"},children:[e.jsx("h3",{style:{fontSize:"1.1rem",marginTop:0},children:"Target for Tomorrow:"}),e.jsx("p",{style:{fontSize:"1.2rem",color:"var(--color-primary)",fontWeight:600},children:p})]})]})}):e.jsx(W,{children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"2rem"},children:[e.jsxs("button",{onClick:()=>i("/"),style:{background:"var(--color-bg-secondary)",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",color:"var(--color-primary)",padding:"0.5rem 1rem",borderRadius:"2rem",fontWeight:"500",marginRight:"1rem"},children:[e.jsx(Y,{size:18})," Back"]}),e.jsx("h2",{style:{margin:0},children:"Today's Reflection"})]}),e.jsxs("form",{onSubmit:M,children:[e.jsxs("div",{className:"card",style:{marginBottom:"1.5rem",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-around",flexWrap:"wrap"},children:[e.jsxs("div",{style:{width:"180px",height:"180px",position:"relative"},children:[e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ke,{children:[e.jsxs(Me,{data:[{name:"Work",value:r,color:"#10b981"},{name:"Procrastination",value:t,color:"#ef4444"}],dataKey:"value",innerRadius:60,outerRadius:80,startAngle:90,endAngle:-270,paddingAngle:5,children:[e.jsx(je,{fill:"#10b981"},"work"),e.jsx(je,{fill:"#ef4444"},"proc")]}),e.jsx(me,{})]})}),e.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:r>=50?"#10b981":"#ef4444"},children:[r,"%"]}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--color-text-secondary)"},children:"Focus"})]})]}),e.jsxs("div",{style:{textAlign:"left",padding:"1rem"},children:[e.jsx("h3",{style:{margin:"0 0 0.5rem",fontSize:"1.2rem"},children:"Day Summary"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.9rem"},children:[e.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"50%",background:"#10b981"}}),e.jsxs("span",{children:["Productive: ",e.jsxs("strong",{children:[u,"m"]})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.9rem"},children:[e.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"50%",background:"#ef4444"}}),e.jsxs("span",{children:["Distracted: ",e.jsxs("strong",{children:[S,"m"]})]})]}),e.jsxs("div",{style:{marginTop:"0.5rem",fontSize:"0.85rem",color:"var(--color-text-secondary)"},children:["Tasks Done: ",e.jsx("strong",{children:B})," | Points: ",e.jsx("strong",{children:z})]})]})]})]}),e.jsxs("div",{className:"card",style:{marginBottom:"2rem"},children:[e.jsxs("h3",{style:{fontSize:"1.1rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(Ue,{size:18})," Activity Log"]}),x.length===0&&l.length===0&&j.length===0?e.jsx("p",{style:{color:"var(--color-text-secondary)",fontStyle:"italic",textAlign:"center",padding:"1rem"},children:"No activity recorded yet."}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[x.map((k,O)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--color-bg-secondary)"},children:[e.jsx("div",{style:{padding:"0.5rem",borderRadius:"50%",background:"#dcfce7",color:"#15803d"},children:e.jsx(ge,{size:16})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:500},children:k.title||k.name}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--color-text-secondary)"},children:"Completed Task"})]}),e.jsxs("div",{style:{fontWeight:"bold",color:"#15803d"},children:[k.timeTaken||0,"m"]})]},`task-${O}`)),j.map((k,O)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--color-bg-secondary)"},children:[e.jsx("div",{style:{padding:"0.5rem",borderRadius:"50%",background:"#dbeafe",color:"#1d4ed8"},children:e.jsx(He,{size:16})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:500},children:k.taskTitle}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--color-text-secondary)"},children:"Work Session"})]}),e.jsxs("div",{style:{fontWeight:"bold",color:"#1d4ed8"},children:[k.duration,"m"]})]},`log-${O}`)),l.map((k,O)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",paddingBottom:"0.75rem",borderBottom:"1px solid var(--color-bg-secondary)"},children:[e.jsx("div",{style:{padding:"0.5rem",borderRadius:"50%",background:"#fee2e2",color:"#b91c1c"},children:e.jsx(Ee,{size:16})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:500},children:k.app}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--color-text-secondary)"},children:k.reasons.join(", ")})]}),e.jsxs("div",{style:{fontWeight:"bold",color:"#b91c1c"},children:[k.duration,"m"]})]},`dist-${O}`))]})]}),e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx(Tt,{size:18})," Goal for Tomorrow"]}),e.jsx("input",{required:!0,value:p,onChange:k=>o(k.target.value),placeholder:"e.g. Finish the Math Chapter without phone",style:{width:"100%",padding:"0.75rem",borderRadius:"var(--radius-md)",border:"1px solid #cbd5e1"}})]}),e.jsx("button",{type:"submit",className:"btn-primary",style:{width:"100%",padding:"1rem"},children:"Save & Close Day"})]})]})})},lr=()=>{const i=G(),[t,s]=d.useState("initial"),[r,a]=d.useState([]),[p,o]=d.useState(""),[l,c]=d.useState(""),[x,w]=d.useState([]),[j,D]=d.useState(null),[L,A]=d.useState(null),[u,v]=d.useState([]),[S,F]=d.useState(""),[B,f]=d.useState("morning");d.useEffect(()=>{const g=new Date().getHours();g>=5&&g<12?f("morning"):g>=12&&g<17?f("afternoon"):g>=17&&g<21?f("evening"):f("night")},[]),d.useEffect(()=>{const g=y("sp_distraction_types",[]);a(g)},[]);const z=()=>{if(!p)return;let g;j?g=r.map(h=>h.id===j?{...h,name:p,reasons:x.length>0?x:["General"]}:h):g=[...r,{id:Date.now(),name:p,reasons:x.length>0?x:["General"]}],N("sp_distraction_types",g),a(g),o(""),w([]),c(""),D(null),s("initial")},R=g=>{o(g.name),w(g.reasons),D(g.id)},M=g=>{if(window.confirm("Delete this distraction type?")){const h=r.filter(U=>U.id!==g);a(h),N("sp_distraction_types",h),j===g&&(D(null),o(""),w([]))}},k=()=>{l&&(w([...x,l]),c(""))},O=g=>{g.preventDefault();const h=y(m.DISTRACTION_LOGS,[]),U={id:Date.now(),app:L.name,reasons:u,duration:S,date:new Date().toISOString()};N(m.DISTRACTION_LOGS,[U,...h]),oe("distraction_log",{app:L.name,reasons:u,duration:parseInt(S)||0,overrideTimeOfDay:B}),s("success")},_=g=>{u.includes(g)?v(u.filter(h=>h!==g)):v([...u,g])},C=()=>{A(null),v([]),F("")};return t==="calm"?e.jsx(W,{children:e.jsxs("div",{className:"container",style:{textAlign:"center",paddingTop:"4rem"},children:[e.jsx("div",{style:{fontSize:"4rem",marginBottom:"1rem"},children:"üåø"}),e.jsx("h2",{children:"Great Job!"}),e.jsx("p",{children:"Focusing on your improvement is the best gift you can give yourself."}),e.jsx("button",{className:"btn-primary",onClick:()=>s("initial"),style:{marginTop:"2rem"},children:"Back"})]})}):t==="success"?e.jsx(W,{children:e.jsxs("div",{className:"container",style:{textAlign:"center",paddingTop:"4rem"},children:[e.jsx("h2",{children:"Logged."}),e.jsx("p",{children:"Awareness is the first step. Use this data tomorrow."}),e.jsx("button",{className:"btn-primary",onClick:()=>{s("initial"),C()},style:{marginTop:"2rem"},children:"Done"})]})}):t==="config"?e.jsx(W,{children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h2",{children:j?"Edit Distraction":"Add Distraction"}),e.jsx("button",{onClick:()=>s("initial"),style:{background:"none",border:"none",cursor:"pointer"},children:e.jsx(Ye,{})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{children:"Distraction Name"}),e.jsx("input",{value:p,onChange:g=>o(g.target.value),placeholder:"e.g. YouTube Shorts"})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{children:"Possible Reasons"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx("input",{value:l,onChange:g=>c(g.target.value),placeholder:"e.g. Boredom"}),e.jsx("button",{type:"button",onClick:k,className:"btn-primary",style:{padding:"0.5rem"},children:e.jsx(he,{size:16})})]}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem"},children:x.map((g,h)=>e.jsx("span",{style:{background:"#f1f5f9",padding:"0.25rem 0.5rem",borderRadius:"4px",fontSize:"0.85rem"},children:g},h))})]}),e.jsx("button",{className:"btn-primary",onClick:z,style:{width:"100%"},children:j?"Update Distraction":"Save Distraction"})]}),e.jsxs("div",{style:{marginTop:"2rem"},children:[e.jsx("h3",{children:"Manage Distractions"}),e.jsxs("div",{style:{display:"grid",gap:"0.5rem"},children:[r.map(g=>e.jsxs("div",{style:{padding:"1rem",background:"var(--color-bg-secondary)",borderRadius:"var(--radius-md)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontWeight:"500"},children:g.name}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{onClick:()=>R(g),style:{background:"none",border:"none",cursor:"pointer",color:"var(--color-primary)"},children:e.jsx($e,{size:18})}),e.jsx("button",{onClick:()=>M(g.id),style:{background:"none",border:"none",cursor:"pointer",color:"#ef4444"},children:e.jsx(ue,{size:18})})]})]},g.id)),r.length===0&&e.jsx("p",{style:{color:"var(--color-text-secondary)"},children:"No distractions added yet."})]})]})]})}):t==="logging"?e.jsx(W,{children:e.jsxs("div",{className:"container",children:[e.jsxs("button",{onClick:()=>{s("initial"),C()},style:{background:"var(--color-bg-secondary)",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",color:"var(--color-primary)",padding:"0.5rem 1rem",borderRadius:"2rem",fontWeight:"500",marginBottom:"1rem"},children:[e.jsx(Y,{size:18})," Back"]}),e.jsx("h2",{children:"Log Distraction"}),L?e.jsxs("form",{onSubmit:O,className:"card",children:[e.jsx("h3",{style:{marginTop:0},children:L.name}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{children:"Why did you check it? (Select all that apply)"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem",marginTop:"0.5rem"},children:L.reasons.map((g,h)=>e.jsx("button",{type:"button",onClick:()=>_(g),style:{padding:"0.5rem 1rem",borderRadius:"2rem",border:"1px solid var(--color-primary)",background:u.includes(g)?"var(--color-primary)":"white",color:u.includes(g)?"white":"var(--color-primary)",cursor:"pointer"},children:g},h))})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{children:"Time Spent (Minutes)"}),e.jsx(ze,{value:S,onChange:F})]}),e.jsx(ve,{value:B,onChange:f}),e.jsx("button",{type:"submit",className:"btn-primary",style:{width:"100%",opacity:S?1:.5,cursor:S?"pointer":"not-allowed"},disabled:!S,children:"Save Log"})]}):e.jsxs("div",{style:{display:"grid",gap:"1.5rem"},children:[e.jsx("p",{style:{textAlign:"center",color:"var(--color-text-secondary)"},children:"What's pulling your attention?"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:"1rem"},children:[r.map(g=>e.jsxs("button",{onClick:()=>A(g),style:{textAlign:"left",cursor:"pointer",border:"1px solid var(--color-bg-secondary)",background:"white",padding:"1.25rem",borderRadius:"var(--radius-lg)",boxShadow:"0 2px 4px rgba(0,0,0,0.05)",transition:"transform 0.1s, border-color 0.1s",display:"flex",alignItems:"center",justifyContent:"space-between"},onMouseEnter:h=>{h.currentTarget.style.borderColor="var(--color-primary)",h.currentTarget.style.transform="translateY(-2px)"},onMouseLeave:h=>{h.currentTarget.style.borderColor="var(--color-bg-secondary)",h.currentTarget.style.transform="translateY(0)"},children:[e.jsx("div",{style:{fontWeight:"600",fontSize:"1.1rem",color:"var(--color-text-primary)"},children:g.name}),e.jsx(Y,{size:16,style:{transform:"rotate(180deg)",color:"var(--color-text-secondary)"}})]},g.id)),e.jsxs("button",{onClick:()=>s("config"),style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",cursor:"pointer",border:"2px dashed var(--color-bg-secondary)",background:"transparent",padding:"1rem",borderRadius:"var(--radius-lg)",color:"var(--color-text-secondary)",fontWeight:"500"},children:[e.jsx(he,{size:20}),e.jsx("span",{children:"Add New"})]})]})]})]})}):e.jsx(W,{children:e.jsxs("div",{className:"container",style:{textAlign:"center",paddingTop:"2rem"},children:[e.jsx("div",{style:{position:"absolute",left:"1rem",top:"5rem"},children:e.jsxs("button",{onClick:()=>i("/"),style:{background:"var(--color-bg-secondary)",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",color:"var(--color-primary)",padding:"0.5rem 1rem",borderRadius:"2rem",fontWeight:"500"},children:[e.jsx(Y,{size:18})," Back"]})}),e.jsx(we,{size:64,style:{color:"var(--color-text-accent)",marginBottom:"1rem"}}),e.jsx("h2",{style:{fontSize:"2rem",marginBottom:"2rem"},children:"Distracted?"}),e.jsxs("div",{style:{display:"grid",gap:"1rem",width:"100%",maxWidth:"320px",margin:"0 auto"},children:[e.jsxs("button",{className:"btn-primary",style:{padding:"1.25rem",fontSize:"1.1rem",background:"#fee2e2",color:"#b91c1c",border:"1px solid #fecaca",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.75rem",borderRadius:"var(--radius-lg)"},onClick:()=>{C(),s("logging")},children:[e.jsx(we,{size:24})," Yes, I gave in"]}),e.jsxs("button",{className:"btn-primary",style:{padding:"1.25rem",fontSize:"1.1rem",background:"#dcfce7",color:"#15803d",border:"1px solid #bbf7d0",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.75rem",borderRadius:"var(--radius-lg)"},onClick:()=>s("calm"),children:[e.jsx(ge,{size:24})," No, I'm focused"]})]}),e.jsx("div",{style:{marginTop:"2rem"},children:e.jsxs("button",{onClick:()=>s("config"),style:{display:"inline-flex",alignItems:"center",gap:"0.5rem",background:"transparent",border:"1px dashed var(--color-text-secondary)",color:"var(--color-text-secondary)",cursor:"pointer",padding:"0.75rem 1.5rem",borderRadius:"var(--radius-full)",fontSize:"0.9rem",transition:"all 0.2s"},children:[e.jsx(he,{size:16})," Add Distraction"]})})]})})},it=(i,t="")=>Object.keys(i).reduce((s,r)=>{const a=t.length?t+".":"";return typeof i[r]=="object"&&i[r]!==null&&!Array.isArray(i[r])?Object.assign(s,it(i[r],a+r)):Array.isArray(i[r])?s[a+r]=i[r].join(";"):s[a+r]=i[r],s},{}),at=i=>{if(!i||i.length===0)return"";const t=i.map(a=>it(a)),s=Array.from(new Set(t.flatMap(Object.keys)));return s.sort((a,p)=>a==="timestamp"?-1:p==="timestamp"?1:a==="event_type"?-1:p==="event_type"?1:a.localeCompare(p)),[s.join(","),...t.map(a=>s.map(p=>{let o=a[p]||"";const l=String(o);return l.includes(",")||l.includes('"')||l.includes(`
`)?`"${l.replace(/"/g,'""')}"`:l}).join(","))].join(`
`)},lt=(i,t="stop-procrastinating-data.csv")=>{const s=new Blob([i],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a");if(r.download!==void 0){const a=URL.createObjectURL(s);r.setAttribute("href",a),r.setAttribute("download",t),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)}},cr=()=>{const i=G(),[t,s]=d.useState([]),[r,a]=d.useState([]);d.useEffect(()=>{const o=y(m.TASKS,[]),l=y(m.SCHEDULED_TASKS,[]),c=y(m.WORK_LOGS,[]),x=y(m.DISTRACTION_LOGS,[]),w=y(m.REFLECTIONS,[]),j={},D=u=>(j[u]||(j[u]={date:new Date(u).toISOString(),taskTime:0,distractionTime:0,pointsScored:0,workScore:0,procrastinationScore:0,tasksDoneCount:0}),j[u]);[...o,...l].forEach(u=>{if(u.completed&&u.completedAt){const v=new Date(u.completedAt).toDateString(),S=D(v);S.taskTime+=parseInt(u.timeTaken)||0,S.tasksDoneCount+=1,u.pointsEarned!==void 0?S.pointsScored+=u.pointsEarned:S.pointsScored+=10+(parseInt(u.timeTaken)||0)}}),c.forEach(u=>{if(u.date){const v=new Date(u.date).toDateString(),S=D(v),F=parseInt(u.duration)||0;S.taskTime+=F,S.pointsScored+=F,S.tasksDoneCount+=1}}),x.forEach(u=>{if(u.date){const v=new Date(u.date).toDateString(),S=D(v);S.distractionTime+=parseInt(u.duration)||0}}),w.forEach(u=>{const v=new Date(u.date).toDateString();j[v]||(j[v]={...u,date:new Date(v).toISOString()})}),Object.keys(j).forEach(u=>{const v=j[u],S=v.taskTime+v.distractionTime;S>0&&(v.procrastinationScore=Math.round(v.distractionTime/S*100),v.workScore=100-v.procrastinationScore)});const L=Object.values(j).sort((u,v)=>new Date(u.date)-new Date(v.date));s(L);const A=ot();a(A)},[]);const p=()=>{const o=y(m.EVENT_LOG,[]);if(!o||o.length===0){alert("No detailed event data found yet. Start using the app to generate logs!");return}const l=at(o);lt(l,`stop_procrastinating_events_${new Date().toISOString().split("T")[0]}.csv`)};return e.jsx(W,{children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"2rem"},children:[e.jsxs("button",{onClick:()=>i("/"),style:{background:"var(--color-bg-secondary)",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",color:"var(--color-primary)",padding:"0.5rem 1rem",borderRadius:"2rem",fontWeight:"500",marginRight:"1rem"},children:[e.jsx(Y,{size:18})," Back"]}),e.jsx("h2",{style:{flex:1,textAlign:"center",margin:0},children:"Progress Analysis"}),e.jsx("button",{onClick:p,style:{background:"transparent",border:"1px solid var(--color-primary)",color:"var(--color-primary)",padding:"0.5rem",borderRadius:"50%",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Export Detailed Event Logs (CSV)",children:e.jsx(fe,{size:20})})]}),e.jsxs("div",{style:{display:"grid",gap:"2rem"},children:[r.length>0&&e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"1rem"},children:r.map((o,l)=>e.jsxs("div",{className:"card",style:{background:o.type==="warning"?"#fef2f2":o.type==="success"?"#f0fdf4":"#f0f9ff",border:o.type==="warning"?"1px solid #fecaca":o.type==="success"?"1px solid #bbf7d0":"1px solid #bae6fd"},children:[e.jsxs("h3",{style:{marginBottom:"0.5rem",fontSize:"1rem",color:o.type==="warning"?"#b91c1c":o.type==="success"?"#15803d":"#0369a1",display:"flex",alignItems:"center",gap:"0.5rem"},children:[o.type==="warning"?e.jsx(Ee,{size:18}):o.type==="success"?e.jsx(Fe,{size:18}):e.jsx(pe,{size:18}),o.title]}),e.jsx("p",{style:{color:o.type==="warning"?"#991b1b":o.type==="success"?"#166534":"#0284c7",fontSize:"0.95rem",margin:0},children:o.text.replace(/\*\*/g,"")})]},l))}),e.jsxs("div",{className:"card",style:{height:"400px",display:"flex",flexDirection:"column"},children:[e.jsx("h3",{style:{marginBottom:"1rem",color:"var(--color-text-primary)"},children:"Focus Consistency"}),e.jsx("p",{style:{fontSize:"0.9rem",color:"var(--color-text-secondary)",marginBottom:"1rem"},children:"Work Score vs Procrastination Score over time."}),e.jsx("div",{style:{flex:1,minHeight:0},children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(wt,{data:t,margin:{top:5,right:5,bottom:5,left:-20},children:[e.jsx(be,{strokeDasharray:"3 3",vertical:!1,stroke:"#e2e8f0"}),e.jsx(De,{dataKey:"date",tickFormatter:o=>new Date(o).getDate()+"/"+(new Date(o).getMonth()+1),tick:{fontSize:12},stroke:"#94a3b8"}),e.jsx(Te,{tick:{fontSize:12},stroke:"#94a3b8"}),e.jsx(me,{labelFormatter:o=>new Date(o).toDateString(),contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"}}),e.jsx(Ne,{}),e.jsx(Le,{type:"monotone",dataKey:"workScore",name:"Work Score",stroke:"#22c55e",strokeWidth:3,dot:{r:4},activeDot:{r:6}}),e.jsx(Le,{type:"monotone",dataKey:"procrastinationScore",name:"Procrastination",stroke:"#ef4444",strokeWidth:3,dot:{r:4}})]})})})]}),e.jsxs("div",{className:"card",style:{height:"400px",display:"flex",flexDirection:"column"},children:[e.jsx("h3",{style:{marginBottom:"1rem",color:"var(--color-text-primary)"},children:"Daily Time Breakdown (Mins)"}),e.jsx("div",{style:{flex:1,minHeight:0},children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(kt,{data:t,margin:{top:5,right:5,bottom:5,left:-20},children:[e.jsx(be,{strokeDasharray:"3 3",vertical:!1,stroke:"#e2e8f0"}),e.jsx(De,{dataKey:"date",tickFormatter:o=>new Date(o).getDate()+"/"+(new Date(o).getMonth()+1),tick:{fontSize:12},stroke:"#94a3b8"}),e.jsx(Te,{tick:{fontSize:12},stroke:"#94a3b8"}),e.jsx(me,{labelFormatter:o=>new Date(o).toDateString(),cursor:{fill:"#f1f5f9"},contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"}}),e.jsx(Ne,{}),e.jsx(Oe,{dataKey:"taskTime",name:"Productive Time",stackId:"a",fill:"#22c55e",radius:[0,0,4,4]}),e.jsx(Oe,{dataKey:"distractionTime",name:"Distracted Time",stackId:"a",fill:"#f97316",radius:[4,4,0,0]})]})})})]}),e.jsxs("div",{className:"card",style:{height:"350px",display:"flex",flexDirection:"column"},children:[e.jsx("h3",{style:{marginBottom:"1rem",color:"var(--color-text-primary)"},children:"Growth (Points Earned)"}),e.jsx("div",{style:{flex:1,minHeight:0},children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ct,{data:t,margin:{top:5,right:5,bottom:5,left:-20},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorPoints",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#8b5cf6",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#8b5cf6",stopOpacity:0})]})}),e.jsx(be,{strokeDasharray:"3 3",vertical:!1,stroke:"#e2e8f0"}),e.jsx(De,{dataKey:"date",tickFormatter:o=>new Date(o).getDate()+"/"+(new Date(o).getMonth()+1),tick:{fontSize:12},stroke:"#94a3b8"}),e.jsx(Te,{tick:{fontSize:12},stroke:"#94a3b8"}),e.jsx(me,{labelFormatter:o=>new Date(o).toDateString(),contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"}}),e.jsx(It,{type:"monotone",dataKey:"pointsScored",name:"Points",stroke:"#8b5cf6",fillOpacity:1,fill:"url(#colorPoints)"})]})})})]})]})]})})},dr=()=>{const i=G(),[t,s]=d.useState(!1),[r,a]=d.useState(null),p=async()=>{s(!0),a(null);try{const l=(await Mt(q,qt)).user,c=Se(ye,"users",l.uid);if((await Ve(c)).exists())rt(),await Qe(l);else{const w={email:l.email,displayName:l.displayName,createdAt:new Date().toISOString(),tasks:JSON.stringify(y(m.TASKS,[])),scheduled:JSON.stringify(y(m.SCHEDULED_TASKS,[])),reflections:JSON.stringify(y(m.REFLECTIONS,[])),stats:JSON.stringify(y(m.USER_STATS,{})),mood:y(m.USER_MOOD,null)};await Xe(c,w),console.log("Local data backed up to cloud!")}i("/")}catch(o){console.error("Login Result Error:",o),a(`Failed to sign in: ${o.message}`)}finally{s(!1)}};return e.jsx(W,{children:e.jsx("div",{className:"container",style:{textAlign:"center",marginTop:"4rem"},children:e.jsxs("div",{className:"card",style:{maxWidth:"400px",margin:"0 auto"},children:[e.jsx("h2",{style:{marginBottom:"1rem"},children:"Backup Your Progress"}),e.jsx("p",{style:{color:"var(--color-text-secondary)",marginBottom:"2rem"},children:"Sign in to save your tasks, streaks, and reflections to the cloud. Access them from any device."}),r&&e.jsx("div",{style:{color:"var(--color-danger)",marginBottom:"1rem",fontSize:"0.9rem"},children:r}),e.jsxs("button",{onClick:p,disabled:t,className:"btn-primary",style:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center",gap:"0.75rem",padding:"0.75rem"},children:[t?e.jsx(At,{className:"spin",size:20}):e.jsx(Pe,{size:20}),t?"Signing In...":"Sign in with Google"]})]})})})},mr=()=>{const[i,t]=d.useState("idle");return d.useEffect(()=>{let s;const r=()=>{t("syncing"),clearTimeout(s)},a=()=>{t("success"),s=setTimeout(()=>{t("idle")},3e3)},p=()=>{t("error")};return window.addEventListener("sp-sync-start",r),window.addEventListener("sp-sync-success",a),window.addEventListener("sp-sync-error",p),()=>{window.removeEventListener("sp-sync-start",r),window.removeEventListener("sp-sync-success",a),window.removeEventListener("sp-sync-error",p),clearTimeout(s)}},[]),e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:"0.5rem",padding:"0.25rem 0.75rem",borderRadius:"2rem",fontSize:"0.85rem",fontWeight:"500",transition:"all 0.3s ease",...pr(i)},children:[ur(i),e.jsx("span",{children:gr(i)})]})},pr=i=>{switch(i){case"syncing":return{background:"#ebf8ff",color:"#0369a1"};case"success":return{background:"#f0fdf4",color:"#166534"};case"error":return{background:"#fef2f2",color:"#991b1b"};default:return{}}},ur=i=>{switch(i){case"syncing":return e.jsx(Je,{size:14,className:"spin"});case"success":return e.jsx(zt,{size:14});case"error":return e.jsx(X,{size:14});default:return e.jsx(Et,{size:14})}},gr=i=>{switch(i){case"syncing":return"Syncing...";case"success":return"Saved";case"error":return"Sync Failed";default:return"Sync Ready"}},yr=()=>{const i=G(),{theme:t,toggleTheme:s}=nt(),r=q.currentUser,[a,p]=d.useState(0),o=()=>{const w=y(m.EVENT_LOG,[]);if(!w||w.length===0){alert("No data to export yet.");return}const j=at(w);lt(j,`stop_procrastinating_backup_${new Date().toISOString().split("T")[0]}.csv`)},l=()=>{window.confirm("ARE YOU SURE? This will delete ALL your logs, streaks, and local data. This action cannot be undone.")&&(rt(),window.location.reload())},c=()=>{Ht(q).then(()=>{i("/"),window.location.reload()})},x=async()=>{await $t()};return e.jsx(W,{children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"2rem"},children:[e.jsxs("button",{onClick:()=>i(-1),className:"btn-secondary",style:{display:"flex",alignItems:"center",gap:"0.5rem",marginRight:"1rem"},children:[e.jsx(Y,{size:18})," Back"]}),e.jsx("h2",{style:{margin:0},children:"Settings"}),e.jsx("div",{style:{marginLeft:"auto"},children:e.jsx(mr,{})})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[e.jsxs("div",{className:"card",children:[e.jsxs("h3",{style:{marginTop:0,marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[t==="light"?e.jsx(Ie,{size:20}):e.jsx(Ce,{size:20})," Appearance"]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"App Theme"}),e.jsx("button",{onClick:s,className:"btn-secondary",style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:t==="light"?"Switch to Dark Mode":"Switch to Light Mode"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h3",{style:{marginTop:0,marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(fe,{size:20})," Data Management"]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsxs("button",{onClick:x,className:"btn-secondary",style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",width:"100%"},children:[e.jsx(Je,{size:18})," Sync Now"]}),e.jsxs("button",{onClick:o,className:"btn-secondary",style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",width:"100%"},children:[e.jsx(fe,{size:18})," Export Data (CSV)"]}),e.jsx("div",{style:{borderTop:"1px solid var(--border-color)",margin:"0.5rem 0"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("strong",{style:{color:"var(--color-danger)"},children:"Danger Zone"}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--color-text-secondary)",margin:0},children:"Irreversible data loss."})]}),e.jsxs("button",{onClick:l,style:{background:"#fee2e2",color:"#b91c1c",border:"1px solid #fca5a5",padding:"0.5rem 1rem",borderRadius:"var(--radius-md)",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.9rem",fontWeight:"500"},children:[e.jsx(ue,{size:16})," Clear All Data"]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h3",{style:{marginTop:0,marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(We,{size:20})," Account"]}),r?e.jsxs("div",{style:{textAlign:"center"},children:[r.photoURL&&e.jsx("img",{src:r.photoURL,alt:"Profile",style:{width:"64px",height:"64px",borderRadius:"50%",marginBottom:"0.5rem"}}),e.jsx("div",{style:{fontWeight:"bold",fontSize:"1.1rem"},children:r.displayName||"User"}),e.jsx("div",{style:{color:"var(--color-text-secondary)",marginBottom:"1.5rem"},children:r.email}),e.jsxs("button",{onClick:c,className:"btn-secondary",style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[e.jsx(Rt,{size:18})," Sign Out"]})]}):e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("p",{children:"You are using a local guest account."}),e.jsx("button",{onClick:()=>i("/signin"),className:"btn-primary",style:{width:"100%"},children:"Sign In with Google"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h3",{style:{marginTop:0,marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(Be,{size:20})," Feedback"]}),e.jsx("p",{style:{color:"var(--color-text-secondary)",fontSize:"0.9rem",marginBottom:"1rem"},children:"Help us improve! Share your experience, report bugs, or suggest new features."}),e.jsxs("a",{href:"https://forms.gle/fh9NiUWpYispsEka6",target:"_blank",rel:"noopener noreferrer",className:"btn-primary",style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",textDecoration:"none",width:"100%"},children:[e.jsx(Be,{size:18})," Send Feedback / Suggestions"]})]}),e.jsxs("div",{style:{textAlign:"center",color:"var(--color-text-secondary)",fontSize:"0.9rem",marginTop:"1rem",cursor:"default"},onClick:()=>p(w=>w+1),children:[e.jsx("p",{children:"Stop Procrastinating v1.0.2"}),e.jsx("p",{children:"Build healthy habits, one day at a time."}),a>5&&e.jsx("p",{children:"ü¶Ñ You found a unicorn!"})]})]})]})})};function xr(){return d.useEffect(()=>{const i=q.onAuthStateChanged(t=>{t&&Qe(t)});return()=>i()},[]),e.jsx(Nt,{children:e.jsxs(Lt,{children:[e.jsx(H,{path:"/",element:e.jsx(Qt,{})}),e.jsx(H,{path:"/analysis",element:e.jsx(cr,{})}),e.jsx(H,{path:"/settings",element:e.jsx(yr,{})}),e.jsx(H,{path:"/signin",element:e.jsx(dr,{})}),e.jsx(H,{path:"/mood",element:e.jsx(rr,{})}),e.jsx(H,{path:"/tasks",element:e.jsx(sr,{})}),e.jsx(H,{path:"/add-task",element:e.jsx(nr,{})}),e.jsx(H,{path:"/complete/:taskId",element:e.jsx(or,{})}),e.jsx(H,{path:"/schedule",element:e.jsx(ir,{})}),e.jsx(H,{path:"/reflect",element:e.jsx(ar,{})}),e.jsx(H,{path:"/limit",element:e.jsx(lr,{})})]})})}Ot.createRoot(document.getElementById("root")).render(e.jsx(d.StrictMode,{children:e.jsx(Yt,{children:e.jsx(xr,{})})}));
